<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body>
    <style>

        .navbar {
            overflow: hidden;
            background-color: #333;
            position: fixed;
            top: 0;
            width: 100%;
        }

            .navbar a {
                float: left;
                display: block;
                color: #ffffff;
                padding: 14px 16px;
                text-decoration: none;
                font-size: 17px;
                width: 100%;
                text-align: left;
            }

        .main {
            padding: 16px;
            margin-top: 30px;
            height: 1500px; /* Used in this example to enable scrolling */
        }
    </style>
    <nav class="navbar  navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span style="color:white" class="glyphicon glyphicon-th-list"></span>
                </button>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="https://milansanghani88.github.io/datatablesnet/datatablesnet.html">Datareader Mapping</a></li>
                    <li><a href="https://milansanghani88.github.io/datatablesnet/extension.html">Extension</a></li>
                    <li><a href="https://milansanghani88.github.io/datatablesnet/encryption.html">Extension</a></li>
                    <li><a href="https://milansanghani88.github.io/datatablesnet/commonapi.html">Common API</a></li>

                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </nav>

    <div class="main" style="padding:0px 6px;">
        <div class="row">
            <div class="col-xs-12">
                <h3>Common API</h3>
                <div>
                    <pre>
public static class CommonAPI
    {
        #region API Call
        public static string ModelPost(string uri, object p)
        {
            throw new NotImplementedException();
        }

        public static int ToInt(this Enum enumValue)
        {
            return (int)((object)enumValue);
        }

        //Common ToList Conversion Methods
        public static List<T> GetListNotInUse<T>(this string value)
        {
            //Call like : CommonAPI.GetAsync(Uri).GetAwaiter().GetResult().GetList<RequisitionerModel>();
            try
            {
                return JsonConvert.DeserializeObject<List<T>>(value);
            }
            catch (Exception)
            {
                if (Convert.ToString(JsonConvert.DeserializeObject(value)) == "AuthenticationFailed" || Convert.ToString(JsonConvert.DeserializeObject(value)) == "Error")
                {
                    return new List<T>();
                }
                else
                {
                    throw;
                }
            }
        }

        //Common ToList Conversion Methods
        public static async Task<APIResultItems<T>> GetList<T>(this Task<string> value) where T : class
        {
            //Call like : await CommonAPI.GetAsync(Uri).GetList<RequisitionerModel>();
            string Resultdata = await value;
            try
            {
                return new APIResultItems<T> { Data = JsonConvert.DeserializeObject<List<T>>(Resultdata), HttpStatusCode = HttpStatusCode.OK };
            }
            catch (Exception)
            {
                if (Convert.ToString(JsonConvert.DeserializeObject(Resultdata)) == "AuthenticationFailed")
                {
                    HttpContext.Current.Response.StatusCode = (int)HttpStatusCode.Forbidden;
                    return new APIResultItems<T> { Data = new List<T>(), HttpStatusCode = HttpStatusCode.Forbidden };
                }
                else if (Convert.ToString(JsonConvert.DeserializeObject(Resultdata)).IndexOf("Error") > -1)
                {
                    throw new Exception(Convert.ToString(JsonConvert.DeserializeObject(Resultdata)));
                }
                else
                {
                    throw;
                }
            }
            //return await JsonConvert.DeserializeObject<Task<List<T>>>(value.Result); //If we have GetAwaiter in Newtonsoft
        }
        //Common ToList Conversion Methods

        //Sync method
        public static APIResultItems<T> GetListSync<T>(this string value) where T : class
        {

            string Resultdata = value;
            try
            {
                return new APIResultItems<T> { Data = JsonConvert.DeserializeObject<List<T>>(Resultdata), HttpStatusCode = HttpStatusCode.OK };
            }
            catch (Exception)
            {
                if (Convert.ToString(JsonConvert.DeserializeObject(Resultdata)) == "AuthenticationFailed")
                {
                    HttpContext.Current.Response.StatusCode = (int)HttpStatusCode.Forbidden;
                    return new APIResultItems<T> { Data = new List<T>(), HttpStatusCode = HttpStatusCode.Forbidden };
                }
                else if (Convert.ToString(JsonConvert.DeserializeObject(Resultdata)).IndexOf("Error") > -1)
                {
                    throw new Exception(Convert.ToString(JsonConvert.DeserializeObject(Resultdata)));
                }
                else
                {
                    throw;
                }
            }
            //return await JsonConvert.DeserializeObject<Task<List<T>>>(value.Result); //If we have GetAwaiter in Newtonsoft
        }
        //Common ToList Conversion Methods
        public static T GetModelNotInUse<T>(this string value)
        {
            //Call like : CommonAPI.GetAsync(Uri).GetAwaiter().GetResult().GetList<RequisitionerModel>();
            try
            {
                return JsonConvert.DeserializeObject<T>(value);
            }
            catch (Exception)
            {
                if (Convert.ToString(JsonConvert.DeserializeObject(value)) == "AuthenticationFailed" || Convert.ToString(JsonConvert.DeserializeObject(value)) == "Error")
                {
                    return (T)Activator.CreateInstance(typeof(T));
                }
                {
                    throw;
                }
            }

        }
        //Common ToList Conversion Methods
        public static async Task<APIResultItem<T>> GetModel<T>(this Task<string> value) where T : class
        {
            string Resultdata = await value;
            try
            {
                return new APIResultItem<T> { Data = JsonConvert.DeserializeObject<T>(Resultdata), HttpStatusCode = HttpStatusCode.OK };
            }
            catch (Exception)
            {
                if (Convert.ToString(JsonConvert.DeserializeObject(Resultdata)) == "AuthenticationFailed")
                {
                    HttpContext.Current.Response.StatusCode = (int)HttpStatusCode.Forbidden;
                    return new APIResultItem<T> { Data = (T)Activator.CreateInstance(typeof(T)), HttpStatusCode = HttpStatusCode.Forbidden };
                }
                else if (Convert.ToString(JsonConvert.DeserializeObject(Resultdata)).IndexOf("Error") > -1)
                {
                    throw new Exception(Convert.ToString(JsonConvert.DeserializeObject(Resultdata)));
                }
                else
                {
                    throw;
                }
            }
        }
        //Common ToList Conversion Methods
        //sync method
        public static APIResultItem<T> GetModelSync<T>(this string value) where T : class
        {
            string Resultdata = value;
            try
            {
                return new APIResultItem<T> { Data = JsonConvert.DeserializeObject<T>(Resultdata), HttpStatusCode = HttpStatusCode.OK };
            }
            catch (Exception)
            {
                if (Convert.ToString(JsonConvert.DeserializeObject(Resultdata)) == "AuthenticationFailed")
                {
                    HttpContext.Current.Response.StatusCode = (int)HttpStatusCode.Forbidden;
                    return new APIResultItem<T> { Data = (T)Activator.CreateInstance(typeof(T)), HttpStatusCode = HttpStatusCode.Forbidden };
                }
                else if (Convert.ToString(JsonConvert.DeserializeObject(Resultdata)).IndexOf("Error") > -1)
                {
                    throw new Exception(Convert.ToString(JsonConvert.DeserializeObject(Resultdata)));
                }
                else
                {
                    throw;
                }
            }
        }
        public static async Task<T> GetModelWithOutStatus<T>(this Task<string> value)
        {
            string Resultdata = await value;
            try
            {
                return JsonConvert.DeserializeObject<T>(Resultdata);
            }
            catch (Exception)
            {
                if (Convert.ToString(JsonConvert.DeserializeObject(Resultdata)) == "AuthenticationFailed" || Convert.ToString(JsonConvert.DeserializeObject(Resultdata)) == "Error")
                {
                    return (T)Activator.CreateInstance(typeof(T));
                }
                else
                {
                    throw;
                }
            }
        }
        //API Call Method: GET
        public static async Task<string> Get(string url, string TenantID = "", string UserID = "", string AccessID = "")
        {
            using (var client = new HttpClient(new HttpClientHandler() { UseDefaultCredentials = true }))
            {
                UserCookieModel CurrentUser = new UserCookieModel();
                if (string.IsNullOrEmpty(TenantID) && string.IsNullOrEmpty(UserID) && string.IsNullOrEmpty(AccessID))
                {
                    CurrentUser = UserUtility.getCookieDetails();
                    client.DefaultRequestHeaders.Add("User-Agent", HttpContext.Current.Request.UserAgent);
                }
                else
                {
                    client.DefaultRequestHeaders.Add("User-Agent", "system");
                }
                url = url + (url.Contains("?") ? '&' : '?');
               url = url + "AccessID=" + (!string.IsNullOrEmpty(AccessID) ? AccessID : CurrentUser.AccessID) + "&TenantID=" + (!string.IsNullOrEmpty(TenantID) ? TenantID : CurrentUser.TenantID) + "&UserID=" + (!string.IsNullOrEmpty(UserID) ? UserID : CurrentUser.UserID);
                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));


                Uri uri = new Uri(ConnectionDB.APIURL + "api/" + url);
                var response = await client.GetAsync(uri);
                if (response.IsSuccessStatusCode)
                {
                    return await response.Content.ReadAsStringAsync();
                }
            }
            return string.Empty;
        }

        //API Call Method: GET
        public static string GetSync(string url, string TenantID = "", string UserID = "", string AccessID = "")
        {
            using (var client = new HttpClient(new HttpClientHandler() { UseDefaultCredentials = true }))
            {
                UserCookieModel CurrentUser = new UserCookieModel();
                if (string.IsNullOrEmpty(TenantID) && string.IsNullOrEmpty(UserID) && string.IsNullOrEmpty(AccessID))
                {
                    CurrentUser = UserUtility.getCookieDetails();
                    client.DefaultRequestHeaders.Add("User-Agent", HttpContext.Current.Request.UserAgent);
                }
                else
                {
                    client.DefaultRequestHeaders.Add("User-Agent", "system");
                }
                url = url + (url.Contains("?") ? '&' : '?');
                url = url + "AccessID=" + (!string.IsNullOrEmpty(AccessID) ? AccessID : CurrentUser.AccessID) + "&TenantID=" + (!string.IsNullOrEmpty(TenantID) ? TenantID : CurrentUser.TenantID) + "&UserID=" + (!string.IsNullOrEmpty(UserID) ? UserID : CurrentUser.UserID);
                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                Uri uri = new Uri(ConnectionDB.APIURL + "api/" + url);
                var response = client.GetAsync(uri).Result;
                if (response.IsSuccessStatusCode)
                {
                    return response.Content.ReadAsStringAsync().Result;
                }
            }
            return string.Empty;
        }

        //API Call Method: POST
        public static async Task<string> Post(string url, string TenantID = "", string UserID = "", string AccessID = "")
        {
            using (var client = new HttpClient(new HttpClientHandler() { UseDefaultCredentials = true }))
            {
                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
                UserCookieModel CurrentUser = new UserCookieModel();
                if (string.IsNullOrEmpty(TenantID) && string.IsNullOrEmpty(UserID) && string.IsNullOrEmpty(AccessID))
                {
                    CurrentUser = UserUtility.getCookieDetails();
                    client.DefaultRequestHeaders.Add("User-Agent", HttpContext.Current.Request.UserAgent);
                }
                else
                {
                    client.DefaultRequestHeaders.Add("User-Agent", "system");
                }
                url = url + (url.Contains("?") ? '&' : '?');
                url = url + "AccessID=" + (!string.IsNullOrEmpty(AccessID) ? AccessID : CurrentUser.AccessID) + "&TenantID=" + (!string.IsNullOrEmpty(TenantID) ? TenantID : CurrentUser.TenantID) + "&UserID=" + (!string.IsNullOrEmpty(UserID) ? UserID : CurrentUser.UserID);
                Uri uri = new Uri(ConnectionDB.APIURL + "api/" + url);
                var response = client.PostAsync(uri, new StringContent(JsonConvert.SerializeObject(""), Encoding.UTF8, "application/json")).Result;
                if (response.IsSuccessStatusCode)
                {
                    return await response.Content.ReadAsStringAsync();
                }
            }
            return string.Empty;
        }

        //API Call Method with Model: POST
        public static async Task<string> ModelPost<T>(string url, T model, string TenantID = "", string UserID = "", string AccessID = "")
        {
            using (var client = new HttpClient(new HttpClientHandler() { UseDefaultCredentials = true }))
            {
                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
                UserCookieModel CurrentUser = new UserCookieModel();
                if (string.IsNullOrEmpty(TenantID) && string.IsNullOrEmpty(UserID) && string.IsNullOrEmpty(AccessID))
                {
                    CurrentUser = UserUtility.getCookieDetails();
                    client.DefaultRequestHeaders.Add("User-Agent", HttpContext.Current.Request.UserAgent);
                }
                else
                {
                    client.DefaultRequestHeaders.Add("User-Agent", "system");
                }
                url = url + (url.Contains("?") ? '&' : '?');
                url = url + "AccessID=" + (!string.IsNullOrEmpty(AccessID) ? AccessID : CurrentUser.AccessID) + "&TenantID=" + (!string.IsNullOrEmpty(TenantID) ? TenantID : CurrentUser.TenantID) + "&UserID=" + (!string.IsNullOrEmpty(UserID) ? UserID : CurrentUser.UserID);
                Uri uri = new Uri(ConnectionDB.APIURL + "api/" + url);

                var response = client.PostAsync(uri, new StringContent(JsonConvert.SerializeObject(model), Encoding.UTF8, "application/json")).Result;
                if (response.IsSuccessStatusCode)
                {
                    return await response.Content.ReadAsStringAsync();
                }
            }
            return string.Empty;
        }

        //API Call Method with Model: POST
        public static string ModelPostSync<T>(string url, T model, string TenantID = "", string UserID = "", string AccessID = "")
        {
            using (var client = new HttpClient(new HttpClientHandler() { UseDefaultCredentials = true }))
            {
                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
                UserCookieModel CurrentUser = new UserCookieModel();
                if (string.IsNullOrEmpty(TenantID) && string.IsNullOrEmpty(UserID) && string.IsNullOrEmpty(AccessID))
                {
                    CurrentUser = UserUtility.getCookieDetails();
                    client.DefaultRequestHeaders.Add("User-Agent", HttpContext.Current.Request.UserAgent);
                }
                else
                {
                    client.DefaultRequestHeaders.Add("User-Agent", "system");
                }
                url = url + (url.Contains("?") ? '&' : '?');
                url = url + "AccessID=" + (!string.IsNullOrEmpty(AccessID) ? AccessID : CurrentUser.AccessID) + "&TenantID=" + (!string.IsNullOrEmpty(TenantID) ? TenantID : CurrentUser.TenantID) + "&UserID=" + (!string.IsNullOrEmpty(UserID) ? UserID : CurrentUser.UserID);
                Uri uri = new Uri(ConnectionDB.APIURL + "api/" + url);

                var response = client.PostAsync(uri, new StringContent(JsonConvert.SerializeObject(model), Encoding.UTF8, "application/json")).Result;
                if (response.IsSuccessStatusCode)
                {
                    return response.Content.ReadAsStringAsync().Result;
                }
            }
            return string.Empty;
        }
        #endregion

        #region API call Without Authentication
        //API Call Method: POST
        public static async Task<string> PostWithoutAuth(string url, string TenantID = "", string UserID = "", string AccessID = "")
        {
            using (var client = new HttpClient(new HttpClientHandler() { UseDefaultCredentials = true }))
            {
                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
                UserCookieModel CurrentUser = new UserCookieModel();
                if (string.IsNullOrEmpty(TenantID) && string.IsNullOrEmpty(UserID) && string.IsNullOrEmpty(AccessID))
                {
                    CurrentUser = UserUtility.getCookieDetails();
                    client.DefaultRequestHeaders.Add("User-Agent", HttpContext.Current.Request.UserAgent);
                }
                else
                {
                    client.DefaultRequestHeaders.Add("User-Agent", "system");
                }
                Uri uri = new Uri(ConnectionDB.APIURL + "api/" + url);
                url = url + (url.Contains("?") ? '&' : '?');
                url = url + "AccessID=" + Encryption.Encrypt(ConnectionDB.WebAPIKey + "|system") + "&TenantID=" + (!string.IsNullOrEmpty(TenantID) ? TenantID : CurrentUser.TenantID) + "&UserID=" + (!string.IsNullOrEmpty(UserID) ? UserID : CurrentUser.UserID);

                var response = client.PostAsync(uri, new StringContent(JsonConvert.SerializeObject(""), Encoding.UTF8, "application/json")).Result;
                if (response.IsSuccessStatusCode)
                {
                    return await response.Content.ReadAsStringAsync();
                }
            }
            return string.Empty;
        }

        //API Call Method with Model: POST
        public static async Task<string> ModelPostWithoutAuth<T>(string url, T model, string TenantID = "", string UserID = "", string AccessID = "")
        {
            using (var client = new HttpClient(new HttpClientHandler() { UseDefaultCredentials = true }))
            {
                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
                UserCookieModel CurrentUser = new UserCookieModel();
                if (string.IsNullOrEmpty(TenantID) && string.IsNullOrEmpty(UserID) && string.IsNullOrEmpty(AccessID))
                {
                    CurrentUser = UserUtility.getCookieDetails();
                    client.DefaultRequestHeaders.Add("User-Agent", HttpContext.Current.Request.UserAgent);
                }
                else
                {
                    client.DefaultRequestHeaders.Add("User-Agent", "system");
                }
                url = url + (url.Contains("?") ? '&' : '?');
                url = url + "AccessID=" + Encryption.Encrypt(ConnectionDB.WebAPIKey + "|system") + "&TenantID=" + (!string.IsNullOrEmpty(TenantID) ? TenantID : CurrentUser.TenantID) + "&UserID=" + (!string.IsNullOrEmpty(UserID) ? UserID : CurrentUser.UserID);

                Uri uri = new Uri(ConnectionDB.APIURL + "api/" + url);

                var response = client.PostAsync(uri, new StringContent(JsonConvert.SerializeObject(model), Encoding.UTF8, "application/json")).Result;
                if (response.IsSuccessStatusCode)
                {
                    return await response.Content.ReadAsStringAsync();
                }
            }
            return string.Empty;
        }

        //API Call Method with Model: POST
        public static string ModelPostWithoutAuthSync<T>(string url, T model, string TenantID = "", string UserID = "", string AccessID = "")
        {
            using (var client = new HttpClient(new HttpClientHandler() { UseDefaultCredentials = true }))
            {
                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
                UserCookieModel CurrentUser = new UserCookieModel();
                if (string.IsNullOrEmpty(TenantID) && string.IsNullOrEmpty(UserID) && string.IsNullOrEmpty(AccessID))
                {
                    CurrentUser = UserUtility.getCookieDetails();
                    client.DefaultRequestHeaders.Add("User-Agent", HttpContext.Current.Request.UserAgent);
                }
                else
                {
                    client.DefaultRequestHeaders.Add("User-Agent", "system");
                }
                url = url + (url.Contains("?") ? '&' : '?');
                url = url + "AccessID=" + Encryption.Encrypt(ConnectionDB.WebAPIKey + "|system") + "&TenantID=" + (!string.IsNullOrEmpty(TenantID) ? TenantID : CurrentUser.TenantID) + "&UserID=" + (!string.IsNullOrEmpty(UserID) ? UserID : CurrentUser.UserID);

                Uri uri = new Uri(ConnectionDB.APIURL + "api/" + url);

                var response = client.PostAsync(uri, new StringContent(JsonConvert.SerializeObject(model), Encoding.UTF8, "application/json")).Result;
                if (response.IsSuccessStatusCode)
                {
                    return response.Content.ReadAsStringAsync().Result;
                }
            }
            return string.Empty;
        }

        //API Call Method: GET
        public static async Task<string> GetWithoutAuth(string url, string TenantID = "", string UserID = "", string AccessID = "")
        {
            var responses = string.Empty;

            using (var client = new HttpClient(new HttpClientHandler() { UseDefaultCredentials = true }))
            {
                UserCookieModel CurrentUser = new UserCookieModel();
                if (string.IsNullOrEmpty(TenantID) && string.IsNullOrEmpty(UserID) && string.IsNullOrEmpty(AccessID))
                {
                    CurrentUser = UserUtility.getCookieDetails();
                    client.DefaultRequestHeaders.Add("User-Agent", HttpContext.Current.Request.UserAgent);
                }
                else
                {
                    client.DefaultRequestHeaders.Add("User-Agent", "system");
                }
                url = url + (url.Contains("?") ? '&' : '?');
                url = url + "AccessID=" + Encryption.Encrypt(ConnectionDB.WebAPIKey + "|system") + "&TenantID=" + (!string.IsNullOrEmpty(TenantID) ? TenantID : CurrentUser.TenantID) + "&UserID=" + (!string.IsNullOrEmpty(UserID) ? UserID : CurrentUser.UserID);
                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
                Uri uri = new Uri(ConnectionDB.APIURL + "api/" + url);
                responses = await client.GetStringAsync(uri);
            }
            return responses;
        }

        public static string GetSyncWithoutAuth(string url, string TenantID = "", string UserID = "", string AccessID = "")
        {
            var responses = string.Empty;

            using (var client = new HttpClient(new HttpClientHandler() { UseDefaultCredentials = true }))
            {
                UserCookieModel CurrentUser = new UserCookieModel();
                if (string.IsNullOrEmpty(TenantID) && string.IsNullOrEmpty(UserID) && string.IsNullOrEmpty(AccessID))
                {
                    CurrentUser = UserUtility.getCookieDetails();
                    client.DefaultRequestHeaders.Add("User-Agent", HttpContext.Current.Request.UserAgent);
                }
                else
                {
                    client.DefaultRequestHeaders.Add("User-Agent", "system");
                }
                url = url + (url.Contains("?") ? '&' : '?');
                url = url + "AccessID=" + Encryption.Encrypt(ConnectionDB.WebAPIKey + "|system") + "&TenantID=" + (!string.IsNullOrEmpty(TenantID) ? TenantID : CurrentUser.TenantID) + "&UserID=" + (!string.IsNullOrEmpty(UserID) ? UserID : CurrentUser.UserID);
                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
                Uri uri = new Uri(ConnectionDB.APIURL + "api/" + url);
                var response = client.GetAsync(uri).Result;
                if (response.IsSuccessStatusCode)
                {
                    return response.Content.ReadAsStringAsync().Result;
                }
            }
            return responses;
        }
        #endregion
    }

    public class CustomImageTagProcessor : iTextSharp.tool.xml.html.Image
    {
        public override IList<IElement> End(IWorkerContext ctx, Tag tag, IList<IElement> currentContent)
        {
            IDictionary<string, string> attributes = tag.Attributes;
            string src;
            if (!attributes.TryGetValue(HTML.Attribute.SRC, out src))
                return new List<IElement>(1);

            if (string.IsNullOrEmpty(src))
                return new List<IElement>(1);

            if (src.StartsWith("data:image/", StringComparison.InvariantCultureIgnoreCase))
            {
                // data:[<MIME-type>][;charset=<encoding>][;base64],<data>
                var base64Data = src.Substring(src.IndexOf(",") + 1);
                var imagedata = Convert.FromBase64String(base64Data);
                var image = iTextSharp.text.Image.GetInstance(imagedata);

                var list = new List<IElement>();
                var htmlPipelineContext = GetHtmlPipelineContext(ctx);
                list.Add(GetCssAppliers().Apply(new Chunk((iTextSharp.text.Image)GetCssAppliers().Apply(image, tag, htmlPipelineContext), 0, 0, true), tag, htmlPipelineContext));
                return list;
            }
            else
            {
                return base.End(ctx, tag, currentContent);
            }
        }
    }

    public static class CommonStaticMethods
    {

        #region Message
        //Get Message by Key
        //public static async Task<MessageModel> GetMessageByKey(string MessageKey)
        //{
        //    try
        //    {
        //        MessageModel msgModel = new MessageModel();

        //        var uri = "ApplicationBase/GetMessageByKey?MessageKey=" + MessageKey;
        //        var response = await CommonAPI.GetAsyncWithoutAuth(uri);
        //        // string test = response;
        //        msgModel = JsonConvert.DeserializeObject<MessageModel>(response);
        //        return msgModel;
        //    }
        //    catch
        //    {
        //        throw;
        //    }
        //}
        public static MessageModel GetMessageByKey(string MessageKey)
        {
            try
            {
                MessageModel msgModel = new MessageModel();

                var uri = "ApplicationBase/GetMessageByKey?MessageKey=" + MessageKey;
                var response = CommonAPI.GetSyncWithoutAuth(uri).GetModelSync<MessageModel>();
                msgModel = response.Data;
                return msgModel;
            }
            catch
            {
                throw;
            }
        }
        #endregion

        //Log Error in the databse
        public static ErrorLogModel SetErrorLogModel(Exception er)
        {
            ErrorLogModel errorLogModel = new ErrorLogModel();
            errorLogModel.ErrorURL = (HttpContext.Current != null && HttpContext.Current.Request.Url != null) ? HttpContext.Current.Request.Url.ToString() : "";
            errorLogModel.ErrorMessage = er.Message;
            errorLogModel.InnerException = er.InnerException != null ? er.InnerException.Message : null;
            errorLogModel.StackTrace = er.StackTrace;
            errorLogModel.TargetSite = er.TargetSite != null ? er.TargetSite.ToString() : null;
            errorLogModel.ErrorSource = er.Source;
            errorLogModel.BrowserDetails = (HttpContext.Current != null && HttpContext.Current.Request.Browser.Browser != null) ? HttpContext.Current.Request.Browser.Browser + " Version: " + HttpContext.Current.Request.Browser.Version : "";
            errorLogModel.CookiesDetails = "";
            errorLogModel.IPAddress = (System.Web.HttpContext.Current != null) ? System.Web.HttpContext.Current.Request.UserHostAddress : "";
            errorLogModel.UserSession = "1";
            // errorLogModel.UserSession = HttpContext.Current.Session != null ? HttpContext.Current.Session[SessionKeys.UserID] != null ? HttpContext.Current.Session["UserID"].ToString() : null : null;
            // Replace your current user session name in SessionKeys class with appropriate session name.

            return errorLogModel;
        }

        //ErrorLog on to text file
        public static void SaveErrorLogToFile(Exception ex)
        {
            string message = string.Format("Time: {0}", DateTime.Now.ToString("dd/MM/yyyy hh:mm:ss tt"));
            message += Environment.NewLine;
            message += "-----------------------------------------------------------";
            message += Environment.NewLine;
            message += string.Format("Message: {0}", ex.Message);
            message += Environment.NewLine;
            message += string.Format("StackTrace: {0}", ex.StackTrace);
            message += Environment.NewLine;
            message += string.Format("Source: {0}", ex.Source);
            message += Environment.NewLine;
            message += string.Format("TargetSite: {0}", ex.TargetSite.ToString());
            message += Environment.NewLine;
            message += "-----------------------------------------------------------";
            message += Environment.NewLine;
            string path = HttpContext.Current.Server.MapPath("~/ErrorLog/ErrorLog" + DateTime.Now.ToString("ddMMyyyy") + ".txt");
            using (StreamWriter writer = new StreamWriter(path, true))
            {
                writer.WriteLine(message);
                writer.Close();
            }
        }

        public static void SchedularWriteLog(string logText, string encryptedTenantID)
        {
            try
            {
                string message = string.Empty;
                message += logText;
                string dirPath = System.Web.Hosting.HostingEnvironment.MapPath("~/ErrorLog/SchedularRunLog-" + encryptedTenantID.Decrypt());
                if (!Directory.Exists(dirPath))
                {
                    Directory.CreateDirectory(dirPath);
                }
                string logFilePath = dirPath + "/" + DateTime.Today.ToString("yyyy-MM-dd") + ".txt";
                using (StreamWriter writer = new StreamWriter(logFilePath, true))
                {
                    writer.WriteLine(message);
                    writer.Close();
                }
            }
            catch (Exception)
            {
                //throw;
            }
        }

        public static void WebhookWriteLog(string logText, string id)
        {
            try
            {
                string message = "-----------------------------------------------------------";
                message += Environment.NewLine;
                message += string.Format("Time: {0}", DateTime.Now.ToString("dd/MM/yyyy hh:mm:ss tt"));
                message += Environment.NewLine;
                message += logText;
                message += Environment.NewLine;
                message += "-----------------------------------------------------------";
                string dirPath = System.Web.Hosting.HostingEnvironment.MapPath("~/ErrorLog/WebhookWriteLog");
                if (!Directory.Exists(dirPath))
                {
                    Directory.CreateDirectory(dirPath);
                }
                string logFilePath = dirPath + "/" + id + ".txt";
                using (StreamWriter writer = new StreamWriter(logFilePath, true))
                {
                    writer.WriteLine(message);
                    writer.Close();
                }
            }
            catch (Exception)
            {
                //throw;
            }
        }

        #region PDF

        public static byte[] createPDF(string html)
        {
            MemoryStream msInput = new MemoryStream(ASCIIEncoding.Default.GetBytes(html));
            MemoryStream msOutput = new MemoryStream();
            // string printPDFCSS = HttpContext.Current.Server.MapPath("~/Content/css/bootstrap.min.css");
            string printPDFCSSt = HttpContext.Current.Server.MapPath("~/Content/css/PDFStyle.css");
            Document doc = new Document(PageSize.A4);
            // doc.SetMargins(10, 10, 10, 50);
            doc.SetMargins(5, 5, 20, 50);
            PdfWriter pdfWriter = PdfWriter.GetInstance(doc, msOutput);



            PageEventHelper pageEventHelper = new PageEventHelper();
            pdfWriter.PageEvent = pageEventHelper;
            doc.Open();

            var tagProcessors = (DefaultTagProcessorFactory)Tags.GetHtmlTagProcessorFactory();
            tagProcessors.RemoveProcessor(HTML.Tag.IMG); // remove the default processor
            tagProcessors.AddProcessor(HTML.Tag.IMG, new CustomImageTagProcessor()); // use our new processor

            Dictionary<String, String> substFonts = new Dictionary<String, String>();
            substFonts["Helvetica"] = "sans-serif";
            CssFilesImpl cssFiles = new CssFilesImpl();
            //cssFiles.Add(XMLWorkerHelper.GetCSS(new FileStream(printPDFCSS, FileMode.Open)));
            cssFiles.Add(XMLWorkerHelper.GetCSS(new FileStream(printPDFCSSt, FileMode.Open)));
            StyleAttrCSSResolver cssResolver = new StyleAttrCSSResolver(cssFiles);
            HtmlPipelineContext hpc = new HtmlPipelineContext(new CssAppliersImpl());
            hpc.SetAcceptUnknown(true).AutoBookmark(true).SetTagFactory(Tags.GetHtmlTagProcessorFactory());
            hpc.SetAcceptUnknown(true).AutoBookmark(true).SetTagFactory(tagProcessors); // inject the tagProcessors
            HtmlPipeline htmlPipeline = new HtmlPipeline(hpc, new PdfWriterPipeline(doc, pdfWriter));
            IPipeline pipeline = new CssResolverPipeline(cssResolver, htmlPipeline);
            XMLWorker worker = new XMLWorker(pipeline, true);
            XMLParser xmlParse = new XMLParser(true, worker);
            xmlParse.Parse(msInput);
            doc.Close();
            return msOutput.ToArray();

        }
        public static byte[] createLandscapePDF(string html)
        {
            MemoryStream msInput = new MemoryStream(ASCIIEncoding.Default.GetBytes(html));
            MemoryStream msOutput = new MemoryStream();
            // string printPDFCSS = HttpContext.Current.Server.MapPath("~/Content/css/bootstrap.min.css");
            string printPDFCSSt = HttpContext.Current.Server.MapPath("~/Content/css/PDFStyle.css");
            Document doc = new Document(PageSize.A4.Rotate());
            // doc.SetMargins(10, 10, 10, 50);
            doc.SetMargins(doc.LeftMargin, doc.RightMargin, 20, 50);
            PdfWriter pdfWriter = PdfWriter.GetInstance(doc, msOutput);
            PageEventHelper pageEventHelper = new PageEventHelper();
            pdfWriter.PageEvent = pageEventHelper;
            doc.Open();
            Dictionary<String, String> substFonts = new Dictionary<String, String>();
            substFonts["Helvetica"] = "sans-serif";
            CssFilesImpl cssFiles = new CssFilesImpl();
            //cssFiles.Add(XMLWorkerHelper.GetCSS(new FileStream(printPDFCSS, FileMode.Open)));
            cssFiles.Add(XMLWorkerHelper.GetCSS(new FileStream(printPDFCSSt, FileMode.Open)));
            StyleAttrCSSResolver cssResolver = new StyleAttrCSSResolver(cssFiles);
            HtmlPipelineContext hpc = new HtmlPipelineContext(new CssAppliersImpl());
            hpc.SetAcceptUnknown(true).AutoBookmark(true).SetTagFactory(Tags.GetHtmlTagProcessorFactory());
            HtmlPipeline htmlPipeline = new HtmlPipeline(hpc, new PdfWriterPipeline(doc, pdfWriter));
            IPipeline pipeline = new CssResolverPipeline(cssResolver, htmlPipeline);
            XMLWorker worker = new XMLWorker(pipeline, true);
            XMLParser xmlParse = new XMLParser(true, worker);
            xmlParse.Parse(msInput);
            doc.Close();
            return msOutput.ToArray();

        }

        //public static void shrinkPDF(string src, string DestFileName)
        //{
        //    PdfReader pdfr = new PdfReader(src);

        //    Document doc = new Document(PageSize.LETTER);
        //    Document.Compress = true;

        //    PdfWriter writer = PdfWriter.GetInstance(doc, new FileStream(DestFileName, FileMode.Create));
        //    doc.Open();

        //    PdfContentByte cb = writer.DirectContent;

        //    PdfImportedPage page;

        //    for (int i = 1; i < pdfr.NumberOfPages + 1; i++)
        //    {
        //        page = writer.GetImportedPage(pdfr, i);
        //        cb.AddTemplate(page, PageSize.LETTER.Width / pdfr.GetPageSize(i).Width*0.96, 0, 0, PageSize.LETTER.Height / pdfr.GetPageSize(i).Height*0.96, 0, 0);
        //        doc.NewPage();
        //    }

        //    doc.Close();

        //    //just renaming, conversion / resize process ends at doc.close() above
        //    //File.Delete(src);
        //    //File.Copy(DestFileName, DestFileName);
        //}


        #endregion

        #region Email
        public static string SendTestEmail(string ToAddress, string Message, string Subject, string ServerName, string Port, string UserName, string Password, string FromEmail, string EnableSSL, string SenderName = null, string ReplyTo = null)
        {
            string strmsg = "";
            try
            {
                SmtpClient smtp = new SmtpClient(ServerName, Convert.ToInt32(Port));
                smtp.Credentials = new NetworkCredential(UserName, Password);
                smtp.EnableSsl = Convert.ToBoolean(EnableSSL);

                MailMessage mailmsg = new MailMessage();
                if (!string.IsNullOrEmpty(FromEmail))
                {
                    mailmsg.From = new MailAddress(FromEmail, (!string.IsNullOrEmpty(SenderName) ? SenderName : ConnectionDB.FromEmailAddress));
                }
                else
                {
                    mailmsg.From = new MailAddress(ConnectionDB.FromEmailAddress, ConnectionDB.FromEmailAddress);
                }

                mailmsg.To.Add(ToAddress);

                if (!string.IsNullOrEmpty(ConnectionDB.CCEmail))
                { mailmsg.CC.Add(ConnectionDB.CCEmail); }

                if (!string.IsNullOrEmpty(ConnectionDB.BCCEmail))
                { mailmsg.Bcc.Add(ConnectionDB.BCCEmail); }
                if (Convert.ToBoolean(EnableSSL) == true)
                {
                    ServicePointManager.ServerCertificateValidationCallback = delegate (object s, X509Certificate certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors) { return true; };
                }
                mailmsg.Body = Message;
                mailmsg.Subject = Subject;
                mailmsg.IsBodyHtml = true;
                mailmsg.Priority = MailPriority.Normal;
                if (!string.IsNullOrEmpty(ReplyTo))
                    mailmsg.ReplyToList.Add(new MailAddress(ReplyTo));

                smtp.Send(mailmsg);
            }
            catch (SmtpException er)
            {
                if (er.InnerException != null)
                {
                    if (er.InnerException.Message != null)
                    {
                        strmsg = er.InnerException.Message.ToString();
                    }
                }
                else if (er.Message != null)
                {
                    strmsg = er.StatusCode.ToString();
                }
            }
            catch (Exception er)
            {
                strmsg = er.ToString();
            }
            return strmsg;
        }

        public static bool SendEmail(EmailSettingModel EmailSettings, EmailTypeModel EmailTypeModel, string ToBccAddress, string ToAddress, String Message, string Subject, string ReplyTo = null, string FromEmail = null, string SenderName = null, string MessageID = null)
        {
            bool mailsended = false;

            try
            {
                SmtpClient smtp = new SmtpClient(EmailSettings.ServerName, Convert.ToInt32(EmailSettings.Port));
                smtp.Credentials = new NetworkCredential(EmailSettings.UserName, EmailSettings.Password);
                smtp.EnableSsl = Convert.ToBoolean(EmailSettings.Secured);

                MailMessage mailmsg = new MailMessage();
                if (!string.IsNullOrEmpty(FromEmail))
                {
                    mailmsg.From = new MailAddress(FromEmail, (!string.IsNullOrEmpty(SenderName) ? SenderName : EmailSettings.Email));
                }
                else
                {
                    mailmsg.From = new MailAddress(EmailSettings.Email, EmailSettings.Email);
                }
                mailmsg.Headers.Add("Message-Id", String.Format("<{0}@{1}>", string.IsNullOrEmpty(MessageID) ? Guid.NewGuid().ToString() : MessageID, EmailSettings.ServerName));
                EmailContentModel EmailContentModel = new EmailContentModel();
                EmailContentModel.Subject = Subject;
                EmailContentModel.Body = Message;
                if (!string.IsNullOrEmpty(ToAddress))
                {
                    var ToAddresssarr = ToAddress.Split(',');
                    if (ToAddresssarr.Length > 1)
                    {
                        foreach (var toAddress in ToAddresssarr)
                        {
                            mailmsg.To.Add(new MailAddress(toAddress));
                        }
                    }
                    else
                    {
                        mailmsg.To.Add(ToAddress);
                    }
                    EmailContentModel.ToEmails = ToAddress;
                }

                if (!string.IsNullOrEmpty(ToBccAddress))
                {
                    var ToBccAddressarr = ToBccAddress.Split(',');
                    if (ToBccAddressarr.Length > 1)
                    {
                        foreach (var toBccAddress in ToBccAddressarr)
                        {
                            mailmsg.Bcc.Add(new MailAddress(toBccAddress));
                        }
                    }
                    else
                    {
                        mailmsg.To.Add(ToAddress);
                    }
                    EmailContentModel.ToEmails = ToBccAddress;
                }

                if (!string.IsNullOrEmpty(ConnectionDB.CCEmail))
                {
                    mailmsg.CC.Add(ConnectionDB.CCEmail);
                }

                if (!string.IsNullOrEmpty(ConnectionDB.BCCEmail))
                { mailmsg.Bcc.Add(ConnectionDB.BCCEmail); }
                if (EmailSettings.Secured == true)
                {
                    ServicePointManager.ServerCertificateValidationCallback = delegate (object s, X509Certificate certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors) { return true; };
                }
                mailmsg.Body = Message;
                mailmsg.Subject = Subject;
                mailmsg.IsBodyHtml = true;
                mailmsg.Priority = MailPriority.Normal;
                if (!string.IsNullOrEmpty(ReplyTo))
                    mailmsg.ReplyToList.Add(new MailAddress(ReplyTo));

                smtp.SendCompleted += (sender, error) =>
                {

                    if (error.Error != null)
                    {
                        SendMailExceptionHandler(error.Error);
                    }
                    smtp.Dispose();
                    mailmsg.Dispose();
                };

                ThreadPool.QueueUserWorkItem(o => smtp.SendAsync(mailmsg, System.Tuple.Create(smtp, mailmsg)));

                mailsended = true;
                SaveEmailLog(EmailTypeModel, EmailContentModel);
            }
            catch (Exception er)
            {
                mailsended = false;
                SendMailExceptionHandler(er);
            }
            return mailsended;

        }

        public static bool SendMailWithAttachments(EmailSettingModel EmailSettings, EmailTypeModel EmailTypeModel, string ToAddress, String Message, string Subject, Attachment[] attachment)
        {
            bool mailsended = false;
            try

            {

                SmtpClient smtp = new SmtpClient(EmailSettings.ServerName, Convert.ToInt32(EmailSettings.Port));
                smtp.Credentials = new NetworkCredential(EmailSettings.UserName, EmailSettings.Password);
                smtp.EnableSsl = Convert.ToBoolean(EmailSettings.Secured);

                MailMessage mailmsg = new MailMessage();
                mailmsg.From = new MailAddress(EmailSettings.Email, EmailSettings.Email);
                mailmsg.To.Add(ToAddress);

                EmailContentModel EmailContentModel = new EmailContentModel();
                EmailContentModel.Subject = Subject;
                EmailContentModel.Body = Message;
                EmailContentModel.ToEmails = ToAddress;

                if (!string.IsNullOrEmpty(ConnectionDB.CCEmail))
                { mailmsg.CC.Add(ConnectionDB.CCEmail); }

                if (!string.IsNullOrEmpty(ConnectionDB.BCCEmail))
                { mailmsg.Bcc.Add(ConnectionDB.BCCEmail); }
                if (EmailSettings.Secured == true)
                {
                    ServicePointManager.ServerCertificateValidationCallback = delegate (object s, X509Certificate certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors) { return true; };
                }
                mailmsg.Body = Message;
                mailmsg.Subject = Subject;
                mailmsg.IsBodyHtml = true;
                mailmsg.Priority = MailPriority.Normal;

                for (int i = 0; i < attachment.Length; i++)
                {
                    if (attachment[i] != null)
                        mailmsg.Attachments.Add(attachment[i]);
                }

                smtp.SendCompleted += (sender, error) =>
                {

                    if (error.Error != null)
                    {
                        SendMailExceptionHandler(error.Error);
                    }
                    smtp.Dispose();
                    mailmsg.Dispose();
                };

                ThreadPool.QueueUserWorkItem(o => smtp.SendAsync(mailmsg, System.Tuple.Create(smtp, mailmsg)));
                mailsended = true;
                SaveEmailLog(EmailTypeModel, EmailContentModel);

            }
            catch (Exception er)
            {
                mailsended = false;
                SendMailExceptionHandler(er);
            }
            return mailsended;
        }

        public async static void SendMailExceptionHandler(Exception er)
        {
            try
            {
                ErrorLogModel errorLogModel;
                ErrorLogInsertViewModel errorLogInsertViewModel;

                errorLogModel = SetErrorLogModel(er);

                if (HttpContext.Current != null && HttpContext.Current.Session[SessionKey.UserLoginSession] != null)
                {
                    var APIResult = CommonAPI.ModelPostSync("Common/InsertErrorLog", errorLogModel).GetModelSync<ErrorLogInsertViewModel>();
                    errorLogInsertViewModel = APIResult.Data;

                }
                else
                {
                    var APIResult = await CommonAPI.ModelPostWithoutAuth("Common/InsertErrorLog", errorLogModel, "0".Encrypt(), "0".Encrypt(), "0".Encrypt()).GetModel<ErrorLogInsertViewModel>();
                    errorLogInsertViewModel = APIResult.Data;
                }
                //using (SqlConnection conn = new SqlConnection(ConnectionDB.DBConn))
                //{
                //    using (SqlCommand cmd = new SqlCommand(ModuleList.usp_app_SaveErrorLog, conn))
                //    {
                //        cmd.CommandType = CommandType.StoredProcedure;
                //        cmd.Parameters.Add(new SqlParameter("@ErrorURL", SqlDbType.VarChar, 2500)).Value = "";
                //        cmd.Parameters.Add(new SqlParameter("@ErrorMessage", SqlDbType.VarChar, 8000)).Value = er.Message;
                //        cmd.Parameters.Add(new SqlParameter("@InnerException", SqlDbType.VarChar, 8000)).Value = er.InnerException;
                //        cmd.Parameters.Add(new SqlParameter("@StackTrace", SqlDbType.VarChar, 8000)).Value = er.StackTrace;
                //        cmd.Parameters.Add(new SqlParameter("@TargetSite", SqlDbType.VarChar, 500)).Value = "";
                //        cmd.Parameters.Add(new SqlParameter("@ErrorSource", SqlDbType.VarChar, 500)).Value = "";
                //        cmd.Parameters.Add(new SqlParameter("@BrowserDetails", SqlDbType.VarChar, 500)).Value = "";
                //        cmd.Parameters.Add(new SqlParameter("@CookiesDetails", SqlDbType.VarChar, 500)).Value = "";
                //        cmd.Parameters.Add(new SqlParameter("@IPAddress", SqlDbType.VarChar, 20)).Value = "";
                //        cmd.Parameters.Add(new SqlParameter("@UserSession", SqlDbType.VarChar, 200)).Value = "";
                //        if (conn.State != ConnectionState.Open)
                //            conn.Open();

                //        using (SqlDataAdapter da = new SqlDataAdapter(cmd))
                //        {
                //            using (DataSet ds = new DataSet())
                //            {
                //                da.Fill(ds);
                //                cmd.Parameters.Clear();
                //                conn.Close();

                //            }
                //        }
                //    }
                //}
            }
            catch (Exception e)
            {
                throw;
            }
        }
        #endregion

        #region Send SMS

        public static bool SendSMS(LeadReminderSMSModel SMSModel, out string MessageID)
        {
            //https://developers.clicksend.com/docs/rest/v2/?csharp#response-codes
            bool result = false;
            MessageID = "";
            string StatusCode = string.Empty;
            if (!Debugger.IsAttached)
            {
                try
                {
                    if (string.IsNullOrEmpty(SMSModel.SMSContent))
                    {
                        result = false;
                        return result;
                    }
                    ClickSendClient client = new ClickSendClient(ConnectionDB.ClickSendUserName, ConnectionDB.ClickSendAPIKey);
                    SmsMessage sms = new SmsMessage();

                    sms.Source = "Website"; //Your method of sending
                    sms.To = "+1" + SMSModel.PhoneNumber; // "+1xxxxxxxx"; // Recipient phone number in E.164 format.
                    sms.Body = SMSModel.SMSContent;
                    sms.From = "+16238888959";
                    sms.CustomString = SMSModel.CustomeString;

                    SmsMessageCollection SMSs = new SmsMessageCollection();

                    SMSs.Messages = new List<SmsMessage>();
                    SMSs.Messages.Add(sms);
                    string SMSresult = client.SMS.SendSms(SMSs);
                    //string message = string.Format("Time: {0}", DateTime.Now.ToString("dd/MM/yyyy hh:mm:ss tt"));
                    //message += Environment.NewLine;
                    //message += "-----------------------------------------------------------";
                    //message += Environment.NewLine;
                    //message += string.Format("Message Result: {0}", SMSresult);
                    //message += Environment.NewLine;
                    //message += string.Format("Message: {0}", SMSModel.SMSContent);
                    //message += Environment.NewLine;
                    //message += "-----------------------------------------------------------";
                    //message += Environment.NewLine;
                    //string path = "B:\\ErrorLog" + DateTime.Now.ToString("ddMMyyyyhhmmsstt") + ".txt"; //static folder path needed as HttpContext is null when we call from schedular
                    //using (StreamWriter writer = new StreamWriter(path, true))
                    //{
                    //    writer.WriteLine(message);
                    //    writer.Close();
                    //}
                    StatusCode = SMSresult;
                    var status = JObject.Parse(StatusCode);
                    var response_code = status["response_code"].ToString();
                    if (response_code == "SUCCESS")
                    {
                        MessageID = status["data"]["messages"][0]["message_id"].ToString();
                        SMSModel.MessageID = MessageID;
                        result = true;
                        LeadSMSNotification LeadSMSModel = new LeadSMSNotification();
                        LeadSMSModel = SaveSMSLog(SMSModel);
                        if (LeadSMSModel.Success != 0)
                        {
                            if (LeadSMSModel.StatusCode != "0" && LeadSMSModel.Message != string.Empty)
                            {
                                SendEmailForSMSMonthlyLimitAboutToOver(LeadSMSModel, SMSModel.TypeReferenceId, SMSModel.UserID);
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    //string message = string.Format("Time: {0}", DateTime.Now.ToString("dd/MM/yyyy hh:mm:ss tt"));
                    //message += Environment.NewLine;
                    //message += "-----------------------------------------------------------";
                    //message += Environment.NewLine;
                    //message += string.Format("Message Result: {0}", ex.Message);
                    //message += Environment.NewLine;
                    //message += string.Format("Message: {0}", SMSModel.SMSContent);
                    //message += Environment.NewLine;
                    //message += "-----------------------------------------------------------";
                    //message += Environment.NewLine;
                    //string path = "B:\\ErrorLog" + DateTime.Now.ToString("ddMMyyyyhhmmsstt") + ".txt";
                    //using (StreamWriter writer = new StreamWriter(path, true))
                    //{
                    //    writer.WriteLine(message);
                    //    writer.Close();
                    //}

                    //StatusCode = "0";
                    result = false;
                }
            }
            return result;
        }

        public static LeadSMSNotification SaveSMSLog(LeadReminderSMSModel SMSModel)
        {
            try
            {
                var APIResult = CommonAPI.ModelPostWithoutAuthSync("Common/SaveSMSLog", SMSModel, "0".Encrypt(), "0".Encrypt(), "0").GetModelSync<LeadSMSNotification>();
                LeadSMSNotification LeadSMSModel = APIResult.Data;
                return LeadSMSModel;
            }
            catch (Exception e)
            {
                throw;
            }
        }

        public static void SaveEmailLog(EmailTypeModel EmailTypeModel, EmailContentModel emailContentModel)
        {
            try
            {
                EmailLogModel emailLogModel = new EmailLogModel();
                emailLogModel.emailContentModel = emailContentModel;
                emailLogModel.emailTypeModel = EmailTypeModel;
                var APIResult = CommonAPI.ModelPostWithoutAuthSync("Common/SaveEmailLog", emailLogModel, "0".Encrypt(), "0".Encrypt(), "0").GetModelSync<LeadSMSNotification>();
                LeadSMSNotification LeadSMSModel = APIResult.Data;
                //return LeadSMSModel;
            }
            catch (Exception e)
            {
                throw;
            }
        }

        public static bool SendEmailForSMSMonthlyLimitAboutToOver(LeadSMSNotification LeadSMSModel, int LeadId, int UserID)
        {
            bool result = false;
            InstrinsicKeyModel instrinsicKeyModel = new InstrinsicKeyModel();
            instrinsicKeyModel.InstrinsicKey = IntrinsicKey.MonthlyLimitSMS;

            string MailBody = string.Empty, MailSubject = string.Empty;
            var response = CommonAPI.ModelPostWithoutAuthSync("Common/SendEmailForSMSMonthlyLimitAboutToOver", instrinsicKeyModel, "0".Encrypt(), "0".Encrypt(), "0").GetModelSync<IntrinsicValueModel>();
            MailBody = response.Data.RunValue;

            MailSubject = "SMS Monthly Limit Uses";

            string CurrentTenantLogo = (LeadSMSModel.PictureID == null) ? "logo1.png" : "TenantLogo/logo" + LeadSMSModel.TenantID.ToString() + Path.GetExtension(LeadSMSModel.PictureName);

            MailBody = MailBody.Replace("##SITEURL##", ConnectionDB.BaseURL);
            MailBody = MailBody.Replace("##MESSAGE##", LeadSMSModel.Message);
            MailBody = MailBody.Replace("##USERNAME##", "Admin");
            MailBody = MailBody.Replace("##TENANTLOGO##", CurrentTenantLogo);

            var EmailSettingModel = CommonAPI.GetSyncWithoutAuth("Common/GetEmailSettings", LeadSMSModel.TenantID.ToString().Encrypt(), "0".Encrypt()).GetModelSync<EmailSettingModel>();

            EmailTypeModel emailTypeModel = new EmailTypeModel();
            emailTypeModel.TenantID = Convert.ToInt32(LeadSMSModel.TenantID);
            emailTypeModel.TypeReferenceId = LeadId;
            emailTypeModel.UserID = UserID;
            emailTypeModel.EmailType = CommonEnum.EmailType.SMSMonthlyLimit.ToInt();
            string ToBccAddress = string.Empty;

            result = CommonStaticMethods.SendEmail(EmailSettingModel.Data, emailTypeModel, ToBccAddress, LeadSMSModel.EmailIds, MailBody, MailSubject);

            return result;
        }
        #endregion

        #region Common method for phone number masking
        public static string PhoneNumberMaskInputMerge(string Phno)
        {
            if (!string.IsNullOrEmpty(Phno))
            {
                return Phno.Replace("(", "").Replace(")", "").Replace(" ", "").Replace("-", "");
            }
            return Phno;
        }
        public static string PhoneNumberMaskInputSplit(string Phno)
        {
            if (!string.IsNullOrEmpty(Phno) && Phno.Trim() != "")
            {
                return Regex.Replace(Phno, @"(\d{3})(\d{3})(\d{4})", "($1) $2-$3");
            }
            return Phno;
        }

        #endregion

        #region check File Exist
        public static bool IsFileExist(string path)
        {
            bool Flag = false;
            if (!string.IsNullOrWhiteSpace(path))
            {
                if (System.IO.File.Exists(System.Web.Hosting.HostingEnvironment.MapPath(path).Replace(".WebAPI", ".Web").Replace(".API", ".Web")))
                    Flag = true;
            }
            return Flag;
        }
        #endregion

    }
    public static class EmailSubject
    {
        public const string SendPOToVendorSubject = "Purchase Order:##POID##";
        public const string SendSOToCustomerSubject = "Sales Order:##SOID##";
        public const string SendShareCatalogSubject = "Shared Catalog(s)";
        public const string SendInventoryAdjusmentNotifySubject = "Threshold Quantity Notification";
        public const string SendImportUserSubject = "User Account detail for ##TENANTNAME##";
        public const string SendReceivedInventoryNotifySubject = "Received Inventory Notification";
        public const string SendKitVariableTrackerScheduleNotifySubject = "Schedule Process Notification";
        public const string SendKitVariableTrackerStartNotifySubject = "Start Process Notification";
        public const string SendKitVariableTrackerCompleteNotifySubject = "Process Complete Notification";
        public const string SendKitVariableTrackerFulfilledNotifySubject = "Ready for pickup";
        public const string MetrcItemSyncSubject = "Metrc items synced";
    }
    public static class IntrinsicKey
    {
        public const string PurchaseOrderEmailBody = "PurchaseOrderEmailBody";
        public const string ChatMaxFileSize = "ChatMaxFileSize";
        public const string ActiveProcessDisplayRefreshSecs = "ActiveProcessDisplayRefreshSecs";
        public const string ActiveProcessDisplayPageFlipSecs = "ActiveProcessDisplayPageFlipSecs";
        public const string SalesOrderEmailBody = "SalesOrderEmailBody";
        public const string InspirationPictureViewRefreshTimeMinutes = "InspirationPictureViewRefreshTimeMinutes";
        public const string ForgotPasswordEmailBody = "ForgotPasswordEmailBody";
        public const string PasswordChangedSuccessfully = "PasswordChangedSuccessfully";
        public const string BrandEnable = "BrandEnable";
        public const string FulfillmentOverageAmount = "FulfillmentOverageAmount";
        public const string TestingCostBurdenOnSplitSOForIncomingOnly = "TestingCostBurdenOnSplitSOForIncomingOnly";
        public const string EnableConfidentCannabis = "EnableConfidentCannabis";
        public const string CRMTenantSubscriptionsCount = "CRMTenantSubscriptionsCount";
        public const string AutomaticVolumeToWeightConversion = "AutomaticVolumeToWeightConversion";
        public const string UserImportEmailBody = "UserImportEmailBody";
        public const string CustomerSignUpEmailBody = "CustomerSignUpEmailBody";
        public const string TenantExpirationOption = "TenantExpirationOption";
        public const string TenantPickedKitExpiration = "TenantPickedKitExpiration";
        public const string MonthlyLimitSMS = "MonthlyLimitSMS";
        public const string AllowToChangeProductionBatchNumber = "AllowToChangeProductionBatchNumber";
        public const string LiabilityAcceptTerms = "LiabilityAcceptTerms";
        public const string ShareCatalogEmailBody = "ShareCatalogEmailBody";
        public const string InventoryOverageNotificationEmailBody = "InventoryOverageNotificationEmailBody";
        public const string InventoryReorderNotificationEmailBody = "InventoryReorderNotificationEmailBody";
        public const string InventoryOverageNotificationSMSBody = "InventoryOverageNotificationSMSBody";
        public const string InventoryReorderNotificationSMSBody = "InventoryReorderNotificationSMSBody";
        public const string InventoryOverageNotificationChatBody = "InventoryOverageNotificationChatBody";
        public const string InventoryReorderNotificationChatBody = "InventoryReorderNotificationChatBody";
        public const string AccessMultipleTenantCustomerLoginBody = "AccessMultipleTenantCustomerLoginBody";
        public const string KitVariableTrackerReceivedInventoryNotifyEmailBody = "KitVariableTrackerReceivedInventoryNotifyEmailBody";
        public const string KitVariableTrackerReceivedInventoryNotifySMSBody = "KitVariableTrackerReceivedInventoryNotifySMSBody";
        public const string KitVariableTrackerScheduledNotifyEmailBody = "KitVariableTrackerScheduledNotifyEmailBody";
        public const string KitVariableTrackerScheduledNotifySMSBody = "KitVariableTrackerScheduledNotifySMSBody";
        public const string KitVariableTrackerStartedNotifyEmailBody = "KitVariableTrackerStartedNotifyEmailBody";
        public const string KitVariableTrackerStartedNotifySMSBody = "KitVariableTrackerStartedNotifySMSBody";
        public const string KitVariableTrackerCompletedProcessNotifyEmailBody = "KitVariableTrackerCompletedProcessNotifyEmailBody";
        public const string KitVariableTrackerCompletedProcessNotifySMSBody = "KitVariableTrackerCompletedProcessNotifySMSBody";
        public const string KitVariableTrackerFulfilledNotifyEmailBody = "KitVariableTrackerFulfilledNotifyEmailBody";
        public const string KitVariableTrackerFulfilledNotifySMSBody = "KitVariableTrackerFulfilledNotifySMSBody";

        public const string ActivateMETRCRoom = "ActivateMETRCRoom##STATE##";

        public const string KitVariableTrackerReceivedInventoryEmailEnable = "KitVariableTrackerReceivedInventoryEmailEnable";
        public const string KitVariableTrackerReceivedInventorySMSEnable = "KitVariableTrackerReceivedInventorySMSEnable";
        public const string KitVariableTrackerScheduleEmailEnable = "KitVariableTrackerScheduleEmailEnable";
        public const string KitVariableTrackerScheduleSMSEnable = "KitVariableTrackerScheduleSMSEnable";
        public const string KitVariableTrackerStartedEmailEnable = "KitVariableTrackerStartedEmailEnable";
        public const string KitVariableTrackerStartedSMSEnable = "KitVariableTrackerStartedSMSEnable";
        public const string KitVariableTrackerCompletedEmailEnable = "KitVariableTrackerCompletedEmailEnable";
        public const string KitVariableTrackerCompletedSMSEnable = "KitVariableTrackerCompletedSMSEnable";
        public const string KitVariableTrackerFulfillEmailEnable = "KitVariableTrackerFulfillEmailEnable";
        public const string KitVariableTrackerFulfillSMSEnable = "KitVariableTrackerFulfillSMSEnable";

        public const string RemoveSalesFulfillmentDate = "RemoveSalesFulfillmentDate";
        public const string MetrcSyncEmailBody = "MetrcSyncEmailBody";
        public const string MetrcSyncUnauthorizedEmailBody = "MetrcSyncUnauthorizedEmailBody";
        public const string GoogleCalendarAPIClientId = "GoogleCalendarAPIClientId";
        public const string GoogleCalendarAPIClientSecret = "GoogleCalendarAPIClientSecret";

        public const string LastEmailNotifyOnpProductNameUpdateFailureEmailBody = "LastEmailNotifyOnpProductNameUpdateFailureEmailBody";
        public const string NotifyAdminUsersOnAutoPauseActiveProcessEmailBody = "NotifyAdminUsersOnAutoPauseActiveProcessEmailBody";
        public const string NotifyAdminUsersOnUnableToApplyPlantCostEmailBody = "NotifyAdminUsersOnUnableToApplyPlantCostEmailBody";

        public const string CustomerAgreementTermsOfUse = "CustomerAgreementTermsOfUse";
        public const string CustomerAgreementPrivacyPolicy = "CustomerAgreementPrivacyPolicy";
        public const string CustomerAgreementTermsAndConditions = "CustomerAgreementTermsAndConditions";
    }
    public static class ProductTypeEnum
    {
        public static string Uncategorized = "Uncategorized";
    }
    public static class CannabisInventoryType
    {
        public static string AvailaleMedical = "Available Medical Inventory";
        public static string UnavailaleMedical = "Unavailable Medical Inventory";
        public static string AvailaleRecreational = "Available Recreational Inventory";
        public static string UnavailaleRecreational = "Unavailable Recreational Inventory";
        public static string EmptyMedical = "Empty Medical Inventory";
        public static string EmptyRecreational = "Empty Recreational Inventory";
        public static string OnHoldMedical = "On Hold Medical Inventory";
        public static string OnHoldRecreational = "On Hold Recreational Inventory";
        public static string FutureMedical = "Future Medical Inventory";
        public static string FutureRecreational = "Future Recreational Inventory";
        public static string ManifestMedical = "Outgoing Medical Inventory";
        public static string ManifestRecreational = "Outgoing Recreational Inventory";
        public static string TransferMedical = "Transfer Medical Inventory";
        public static string TransferRecreational = "Transfer Recreational Inventory";

        public static string AvailaleCannabis = "Available Cannabis Inventory";
        public static string UnavailaleCannabis = "Unavailable Cannabis Inventory";
        public static string EmptyCannabis = "Empty Cannabis Inventory";
        public static string OnHoldCannabis = "On Hold Cannabis Inventory";
        public static string FutureCannabis = "Future Cannabis Inventory";
        public static string ManifestCannabis = "Outgoing Cannabis Inventory";
        public static string TransferCannabis = "Transfer Cannabis Inventory";
    }
    public static class HempInventoryType
    {
        public static string AvailaleHemp = "Available Hemp Inventory";
        public static string UnavailaleHemp = "Unavailable Hemp Inventory";
        public static string EmptyHemp = "Empty Hemp Inventory";
        public static string TransferHemp = "Transfer Hemp Inventory";
        public static string FutureHemp = "Future Hemp Inventory";
    }
    public static class PlantsType
    {
        public static string Immature = "Immature";
        public static string Vegetative = "Vegetative";
        public static string Flowering = "Flowering";
        public static string Harvested = "Harvested";
        public static string OnHold = "On Hold";
        public static string Inactive = "Inactive";
    }
    public class CommonExcelMethod
    {
        #region Common Method For Excel Report
        public string[] CommonExcelReportDownload(string[] HeaderVal, DataTable dt, object[] SearchHeader, object[] strSearchParam, string strReportName, string[] rightAlignColumns, string OldFile = null, string LeadExportname = null, string[] AllColumnWithHidden = null)
        {
            string FolderName = DateTime.Now.ToString("dd-MM-yyyy") + "_Report";
            string strFileName = string.Empty;

            string path = System.Web.Hosting.HostingEnvironment.MapPath("~/Upload/Excel/" + FolderName).Replace(".WebAPI", ".Web").Replace(".API", ".Web");
            //string path = HttpContext.Current.Server.MapPath("~/Upload/Excel/" + FolderName).Replace("Lakshmi.WebAPI", "Lakshmi.Web");
            string filename = string.Empty;
            if (!Directory.Exists(path))
                Directory.CreateDirectory(path);

            string[] strvalue = null;
            SLDocument slDocument = null;

            //customize for Lead Export
            if (LeadExportname != null)
            {
                if (OldFile == null)
                {
                    slDocument = new SLDocument();

                    strFileName = LeadExportname + ".xlsx";
                    filename = path + "\\" + strFileName;
                    strReportName = LeadExportname;
                }
                else
                {
                    slDocument = new SLDocument(path + "\\" + OldFile);
                    slDocument.AddWorksheet(LeadExportname);

                    strFileName = OldFile;
                    filename = path + "\\" + strFileName;
                }
            }
            else
            {
                if (OldFile == null)
                {
                    slDocument = new SLDocument();

                    strFileName = strReportName + "_" + DateTime.Now.ToString("ddMMyyyyHHMMss") + ".xlsx";
                    filename = path + "\\" + strFileName;
                }
                else
                {
                    slDocument = new SLDocument(path + "\\" + OldFile);
                    slDocument.AddWorksheet(strReportName);

                    strFileName = OldFile;
                    filename = path + "\\" + strFileName;
                }
            }

            SLStyle style = slDocument.CreateStyle();
            style.Font.Bold = true;
            style.Font.FontSize = 22;
            style.Font.FontName = "Arial";
            style.Font.Underline = UnderlineValues.Single;
            style.Alignment.Horizontal = HorizontalAlignmentValues.Center;
            slDocument.MergeWorksheetCells("A2", "I2", style);
            slDocument.SetCellValue("A2", strReportName);
            //---Row height Start---
            slDocument.SetRowHeight(2, 25);
            slDocument.SetRowHeight(4, 20);
            //---Row height End---

            int rowHeaderIndex = 8;
            int rowDataHeaderIndex = 9;
            if (SearchHeader != null && SearchHeader.Length > 0)
            {
                // Set Searching parameter Header
                style = slDocument.CreateStyle();
                style.Font.Bold = true;
                style.Font.FontSize = 14;
                style.Font.FontName = "Arial";
                style.Border.TopBorder.BorderStyle = BorderStyleValues.Thin;
                style.Border.TopBorder.Color = System.Drawing.Color.Black;
                style.Border.RightBorder.BorderStyle = BorderStyleValues.Thin;
                style.Border.RightBorder.Color = System.Drawing.Color.Black;
                style.Border.BottomBorder.BorderStyle = BorderStyleValues.Thin;
                style.Border.BottomBorder.Color = System.Drawing.Color.Black;

                slDocument.SetCellValue(4, 1, "Filter");
                //set Filter Style

                int rowfilterIndex = 4;
                int ColfilterIndex = 1;
                for (var i = 0; i <= (SearchHeader.Length - 1); i++)
                {
                    slDocument.SetCellStyle(rowfilterIndex, ColfilterIndex, style);
                    ColfilterIndex++;
                }
                style = slDocument.CreateStyle();
                style.Font.Bold = true;
                style.Font.FontSize = 13;
                style.Font.FontName = "Arial";
                style.Border.TopBorder.BorderStyle = BorderStyleValues.Thin;
                style.Border.TopBorder.Color = System.Drawing.Color.Black;
                style.Border.RightBorder.BorderStyle = BorderStyleValues.Thin;
                style.Border.RightBorder.Color = System.Drawing.Color.Black;
                style.Border.BottomBorder.BorderStyle = BorderStyleValues.Thin;
                style.Border.BottomBorder.Color = System.Drawing.Color.Black;

                int rowHeaderSearchIndex = 5;
                int ColHeaderSearchIndex = 1;
                for (var i = 0; i <= (SearchHeader.Length - 1); i++)
                {
                    var val = SearchHeader[i].ToString();
                    slDocument.SetCellStyle(rowHeaderSearchIndex, ColHeaderSearchIndex, style);
                    slDocument.SetCellValue(rowHeaderSearchIndex, ColHeaderSearchIndex, val);
                    ColHeaderSearchIndex++;
                }

                //set Searching Data
                style = slDocument.CreateStyle();
                style.Font.FontName = "Arial";
                style.Font.FontSize = 13;
                style.Border.TopBorder.BorderStyle = BorderStyleValues.Thin;
                style.Border.TopBorder.Color = System.Drawing.Color.Black;
                style.Border.RightBorder.BorderStyle = BorderStyleValues.Thin;
                style.Border.RightBorder.Color = System.Drawing.Color.Black;
                style.Border.BottomBorder.BorderStyle = BorderStyleValues.Thin;
                style.Border.BottomBorder.Color = System.Drawing.Color.Black;
                int rowHeaderSearchValIndex = 6;
                int ColHeaderSearchValIndex = 1;
                if (strSearchParam != null)
                {
                    for (var i = 0; i <= (strSearchParam.Length - 1); i++)
                    {
                        var cellval = Convert.ToString(strSearchParam[i]);
                        slDocument.SetCellStyle(rowHeaderSearchValIndex, ColHeaderSearchValIndex, style);
                        slDocument.SetCellValue(rowHeaderSearchValIndex, ColHeaderSearchValIndex, cellval);
                        ColHeaderSearchValIndex++;
                    }
                }
            }
            else
            {
                rowHeaderIndex = 4;
                rowDataHeaderIndex = 5;
            }

            //Table Column Heading
            style = slDocument.CreateStyle();
            style.Font.Bold = true;
            style.Font.FontSize = 14;
            style.Border.TopBorder.BorderStyle = BorderStyleValues.Thin;
            style.Border.TopBorder.Color = System.Drawing.Color.Black;
            style.Border.RightBorder.BorderStyle = BorderStyleValues.Thin;
            style.Border.RightBorder.Color = System.Drawing.Color.Black;
            style.Border.BottomBorder.BorderStyle = BorderStyleValues.Thin;
            style.Border.BottomBorder.Color = System.Drawing.Color.Black;
            style.Font.FontName = "Arial";

            int ColHeaderIndex = 1;
            string FirstColName = HeaderVal[0];
            if (FirstColName.ToLower() != "tenant name")
            {
                if (rightAlignColumns != null)
                {
                    for (int i = 0; i < rightAlignColumns.Length; i++)
                    {
                        rightAlignColumns[i] = Convert.ToString(Convert.ToInt32(rightAlignColumns[i]) - 2);
                    }
                }
            }
            else if (FirstColName.ToLower() == "tenant name")
            {
                if (rightAlignColumns != null)
                {
                    for (int i = 0; i < rightAlignColumns.Length; i++)
                    {
                        rightAlignColumns[i] = Convert.ToString(Convert.ToInt32(rightAlignColumns[i]) - 1);
                    }
                }
            }

            foreach (var item in HeaderVal.ToList())
            {
                slDocument.SetCellValue(rowHeaderIndex, ColHeaderIndex, item);
                slDocument.SetCellStyle(rowHeaderIndex, ColHeaderIndex, style);
                ColHeaderIndex++;
            }

            //Data
            style = slDocument.CreateStyle();
            style.Font.FontName = "Arial";
            style.Font.FontSize = 13;
            style.Border.TopBorder.BorderStyle = BorderStyleValues.Thin;
            style.Border.TopBorder.Color = System.Drawing.Color.Black;
            style.Border.RightBorder.BorderStyle = BorderStyleValues.Thin;
            style.Border.RightBorder.Color = System.Drawing.Color.Black;
            style.Border.BottomBorder.BorderStyle = BorderStyleValues.Thin;
            style.Border.BottomBorder.Color = System.Drawing.Color.Black;

            int ColDataHeaderIndex = 0;
            for (int i = 0; i < dt.Rows.Count; i++)
            {
                ColDataHeaderIndex = 1;
                for (int j = 0; j < dt.Columns.Count; j++)
                {
                    if (AllColumnWithHidden != null)
                    {
                        if (HeaderVal.Any(x => x == AllColumnWithHidden[j]))
                        {
                            if (rightAlignColumns != null)
                            {
                                var result = rightAlignColumns.Where(x => x == j.ToString()).SingleOrDefault();
                                if (!string.IsNullOrEmpty(result))
                                {
                                    style.Alignment.Horizontal = HorizontalAlignmentValues.Right;
                                }
                                else
                                {
                                    style.Alignment.Horizontal = HorizontalAlignmentValues.Left;
                                }
                            }
                            else
                            {
                                style.Alignment.Horizontal = HorizontalAlignmentValues.Left;
                            }
                            string values = Convert.ToString(dt.Rows[i][j]);

                            if (values.StartsWith("$") && Regex.Matches(values, @"[a-zA-Z]").Count == 0 || (values.IndexOf("-") == 0 && values.IndexOf("$") == 1))
                            {
                                slDocument.ApplyNamedCellStyle(rowDataHeaderIndex, ColDataHeaderIndex, SLNamedCellStyleValues.Currency);
                                slDocument.SetCellValue(rowDataHeaderIndex, ColDataHeaderIndex, Convert.ToDecimal(values.Replace("$", "")));
                                slDocument.SetCellStyle(rowDataHeaderIndex, ColDataHeaderIndex, style);
                            }
                            else if (style.Alignment.Horizontal == HorizontalAlignmentValues.Right && Regex.Matches(values, @"[a-zA-Z|*:%]").Count == 0)
                            {
                                if (!string.IsNullOrWhiteSpace(values))
                                {
                                    slDocument.SetCellValue(rowDataHeaderIndex, ColDataHeaderIndex, Convert.ToDecimal(values));
                                    slDocument.SetCellStyle(rowDataHeaderIndex, ColDataHeaderIndex, style);
                                }
                                else
                                {
                                    slDocument.SetCellValue(rowDataHeaderIndex, ColDataHeaderIndex, "");
                                    slDocument.SetCellStyle(rowDataHeaderIndex, ColDataHeaderIndex, style);
                                }
                            }
                            else
                            {
                                slDocument.SetCellValue(rowDataHeaderIndex, ColDataHeaderIndex, values);
                                slDocument.SetCellStyle(rowDataHeaderIndex, ColDataHeaderIndex, style);
                            }

                            ColDataHeaderIndex++;
                        }
                    }
                    else
                    {
                        if (rightAlignColumns != null)
                        {
                            var result = rightAlignColumns.Where(x => x == j.ToString()).SingleOrDefault();
                            if (!string.IsNullOrEmpty(result))
                            {
                                style.Alignment.Horizontal = HorizontalAlignmentValues.Right;
                            }
                            else
                            {
                                style.Alignment.Horizontal = HorizontalAlignmentValues.Left;
                            }
                        }
                        else
                        {
                            style.Alignment.Horizontal = HorizontalAlignmentValues.Left;
                        }
                        string values = Convert.ToString(dt.Rows[i][j]);

                        if (values.StartsWith("$") && Regex.Matches(values, @"[a-zA-Z]").Count == 0 || (values.IndexOf("-") == 0 && values.IndexOf("$") == 1))
                        {
                            slDocument.ApplyNamedCellStyle(rowDataHeaderIndex, ColDataHeaderIndex, SLNamedCellStyleValues.Currency);
                            slDocument.SetCellValue(rowDataHeaderIndex, ColDataHeaderIndex, Convert.ToDecimal(values.Replace("$", "")));
                            slDocument.SetCellStyle(rowDataHeaderIndex, ColDataHeaderIndex, style);
                        }
                        else if (style.Alignment.Horizontal == HorizontalAlignmentValues.Right && Regex.Matches(values, @"[a-zA-Z|*:%]").Count == 0)
                        {
                            if (!string.IsNullOrWhiteSpace(values))
                            {
                                slDocument.SetCellValue(rowDataHeaderIndex, ColDataHeaderIndex, Convert.ToDecimal(values));
                                slDocument.SetCellStyle(rowDataHeaderIndex, ColDataHeaderIndex, style);
                            }
                            else
                            {
                                slDocument.SetCellValue(rowDataHeaderIndex, ColDataHeaderIndex, "");
                                slDocument.SetCellStyle(rowDataHeaderIndex, ColDataHeaderIndex, style);
                            }
                        }
                        else
                        {
                            slDocument.SetCellValue(rowDataHeaderIndex, ColDataHeaderIndex, values);
                            slDocument.SetCellStyle(rowDataHeaderIndex, ColDataHeaderIndex, style);
                        }

                        ColDataHeaderIndex++;
                    }
                }
                rowDataHeaderIndex++;
            }

            //--------------------Save File Start----------------------------------

            if (System.IO.File.Exists(filename))
            {
                System.IO.File.Delete(filename);
            }
            //---AutoFit Start---
            slDocument.AutoFitColumn(1, HeaderVal.Length);
            slDocument.AutoFitRow(1);
            //---AutoFit End---
            slDocument.RenameWorksheet(SLDocument.DefaultFirstSheetName, strReportName);
            SLPageSettings ps = slDocument.GetPageSettings();
            //---page view Setting Start---
            ps.Orientation = OrientationValues.Landscape;
            ps.PaperSize = SLPaperSizeValues.A4Paper;
            // 83% of normal page size
            ps.ScalePage(83);
            //---page view Setting End---
            //--- footer setting Start---
            ps.SetLeftFooterText("&[File]  /  &[Tab]");
            ps.SetCenterFooterText("&[Page] of &[Pages]");
            ps.SetRightFooterText("&[Date]");
            //--- footer setting End--
            //---Margin setting start---
            ps.TopMargin = 0.236;
            ps.LeftMargin = 0.25;
            ps.BottomMargin = 0.44;
            ps.FooterMargin = 0.157;
            ps.RightMargin = 0.25;
            ps.HeaderMargin = 0.118;
            //---margin Setting End---

            //--- Grid Line Setting Start---
            ps.PrintGridLines = true;
            ps.ShowGridLines = true;
            //--- Grid Line Setting End---

            //---Zooming setting Start---
            ps.ZoomScale = 75;
            //---Zooming setting End---

            ps.PageOrder = PageOrderValues.DownThenOver;

            //---Sheet Setting End---
            slDocument.SetPageSettings(ps);
            //-------------------Page Layout setting End-----------------------------------
            slDocument.SaveAs(filename);

            strvalue = new string[] { strFileName, FolderName };
            return strvalue;
        }

        public string[] ExcelReportDownloadForOMMAReport(object[] SearchHeader, object[] strSearchParam, string strReportName, CommercialLicenseMonthlyReportListModel BRList = null, List<CommercialLicenseMonthlyReportForSaleModel> sList = null)
        {
            string FolderName = DateTime.Now.ToString("dd-MM-yyyy") + "_Report";
            string strFileName = string.Empty;

            string path = System.Web.Hosting.HostingEnvironment.MapPath("~/Upload/Excel/" + FolderName).Replace(".WebAPI", ".Web").Replace(".API", ".Web");
            //string path = HttpContext.Current.Server.MapPath("~/Upload/Excel/" + FolderName).Replace("Lakshmi.WebAPI", "Lakshmi.Web");
            string filename = string.Empty;
            if (!Directory.Exists(path))
                Directory.CreateDirectory(path);

            string[] strvalue = null;
            SLDocument slDocument = null;

            slDocument = new SLDocument();
            strFileName = strReportName + "_" + DateTime.Now.ToString("ddMMyyyyHHMMss") + ".xlsx";
            filename = path + "\\" + strFileName;

            SLStyle style = slDocument.CreateStyle();
            style.Font.Bold = true;
            style.Font.FontSize = 22;
            style.Font.FontName = "Arial";
            style.Font.Underline = UnderlineValues.Single;
            style.Alignment.Horizontal = HorizontalAlignmentValues.Center;
            slDocument.MergeWorksheetCells("A2", "I2", style);
            slDocument.SetCellValue("A2", strReportName);
            //---Row height Start---
            slDocument.SetRowHeight(2, 25);
            slDocument.SetRowHeight(4, 20);
            slDocument.SetColumnWidth("B", 18);
            slDocument.SetColumnWidth("C", 18);
            slDocument.SetColumnWidth("D", 18);
            slDocument.SetColumnWidth("E", 18);
            slDocument.SetColumnWidth("F", 18);
            slDocument.SetColumnWidth("G", 18);
            slDocument.SetColumnWidth("H", 18);
            slDocument.SetColumnWidth("I", 18);
            //---Row height End---

            #region Each Report Title Style
            SLStyle eachReportTitleStyle = slDocument.CreateStyle();
            eachReportTitleStyle.Font.Bold = true;
            eachReportTitleStyle.Font.FontSize = 14;
            eachReportTitleStyle.Font.FontName = "Arial";
            eachReportTitleStyle.Border.TopBorder.BorderStyle = BorderStyleValues.Thin;
            eachReportTitleStyle.Border.TopBorder.Color = System.Drawing.Color.Black;
            eachReportTitleStyle.Border.RightBorder.BorderStyle = BorderStyleValues.Thin;
            eachReportTitleStyle.Border.RightBorder.Color = System.Drawing.Color.Black;
            eachReportTitleStyle.Border.BottomBorder.BorderStyle = BorderStyleValues.Thin;
            eachReportTitleStyle.Border.BottomBorder.Color = System.Drawing.Color.Black;
            //eachReportTitleStyle.SetPatternFill(PatternValues.Gray125, SLThemeColorIndexValues.Accent2Color, SLThemeColorIndexValues.Accent5Color);
            #endregion

            #region Column Heading Style
            SLStyle columnHeadingStyle = slDocument.CreateStyle();
            columnHeadingStyle.Font.Bold = true;
            columnHeadingStyle.Font.FontSize = 14;
            columnHeadingStyle.Border.TopBorder.BorderStyle = BorderStyleValues.Thin;
            columnHeadingStyle.Border.TopBorder.Color = System.Drawing.Color.Black;
            columnHeadingStyle.Border.RightBorder.BorderStyle = BorderStyleValues.Thin;
            columnHeadingStyle.Border.RightBorder.Color = System.Drawing.Color.Black;
            columnHeadingStyle.Border.BottomBorder.BorderStyle = BorderStyleValues.Thin;
            columnHeadingStyle.Border.BottomBorder.Color = System.Drawing.Color.Black;
            columnHeadingStyle.Alignment.Horizontal = HorizontalAlignmentValues.Center;
            columnHeadingStyle.Font.FontName = "Arial";
            #endregion

            #region Column Data Style
            SLStyle columnDataStyle = slDocument.CreateStyle();
            columnDataStyle.Font.FontName = "Arial";
            columnDataStyle.Font.FontSize = 13;
            columnDataStyle.Border.TopBorder.BorderStyle = BorderStyleValues.Thin;
            columnDataStyle.Border.TopBorder.Color = System.Drawing.Color.Black;
            columnDataStyle.Border.RightBorder.BorderStyle = BorderStyleValues.Thin;
            columnDataStyle.Border.RightBorder.Color = System.Drawing.Color.Black;
            columnDataStyle.Border.BottomBorder.BorderStyle = BorderStyleValues.Thin;
            columnDataStyle.Border.BottomBorder.Color = System.Drawing.Color.Black;
            columnDataStyle.Alignment.Horizontal = HorizontalAlignmentValues.Center;
            #endregion

            slDocument.MergeWorksheetCells("A4", "C4", eachReportTitleStyle);
            slDocument.SetCellValue(4, 1, "Filter");

            for (var i = 0; i <= (SearchHeader.Length - 1); i++)
            {
                var val = SearchHeader[i].ToString();
                slDocument.SetCellStyle(5, i + 1, columnHeadingStyle);
                slDocument.SetCellValue(5, i + 1, val);
            }

            if (strSearchParam != null)
            {
                for (var i = 0; i <= (strSearchParam.Length - 1); i++)
                {
                    var cellval = Convert.ToString(strSearchParam[i]);
                    slDocument.SetCellStyle(6, i + 1, columnDataStyle);
                    slDocument.SetCellValue(6, i + 1, cellval);
                }
            }

            if (BRList.OMMACommercialLicenseHeaderData != null)
            {
                slDocument.MergeWorksheetCells("A8", "D8", eachReportTitleStyle);
                slDocument.SetCellValue(8, 1, "Licensee Information");

                //Licensee Information.
                slDocument.MergeWorksheetCells("A9", "B9", eachReportTitleStyle);
                slDocument.SetCellValue(9, 1, "License Type");
                slDocument.MergeWorksheetCells("C9", "D9", columnDataStyle);
                slDocument.SetCellValue(9, 3, BRList.OMMACommercialLicenseHeaderData.LicenseType);

                slDocument.MergeWorksheetCells("A10", "B10", eachReportTitleStyle);
                slDocument.SetCellValue(10, 1, "OMMA License ID/Number");
                slDocument.MergeWorksheetCells("C10", "D10", columnDataStyle);
                slDocument.SetCellValue(10, 3, BRList.OMMACommercialLicenseHeaderData.OMMALicenseNumber);

                slDocument.MergeWorksheetCells("A11", "B11", eachReportTitleStyle);
                slDocument.SetCellValue(11, 1, "OBNDD Registration Number");
                slDocument.MergeWorksheetCells("C11", "D11", columnDataStyle);
                slDocument.SetCellValue(11, 3, BRList.OMMACommercialLicenseHeaderData.OBNDDRegistrationNumber);

                slDocument.MergeWorksheetCells("A12", "B12", eachReportTitleStyle);
                slDocument.SetCellValue(12, 1, "Tax ID Number");
                slDocument.MergeWorksheetCells("C12", "D12", columnDataStyle);
                slDocument.SetCellValue(12, 3, BRList.OMMACommercialLicenseHeaderData.TaxIDNumber);

                slDocument.MergeWorksheetCells("A13", "B13", eachReportTitleStyle);
                slDocument.SetCellValue(13, 1, "Food License Number");
                slDocument.MergeWorksheetCells("C13", "D13", columnDataStyle);
                slDocument.SetCellValue(13, 3, BRList.OMMACommercialLicenseHeaderData.FoodLicenseNumber);

                slDocument.MergeWorksheetCells("A14", "B14", eachReportTitleStyle);
                slDocument.SetCellValue(14, 1, "Entity Name");
                slDocument.MergeWorksheetCells("C14", "D14", columnDataStyle);
                slDocument.SetCellValue(14, 3, BRList.OMMACommercialLicenseHeaderData.EntityName);

                slDocument.MergeWorksheetCells("A16", "D16", eachReportTitleStyle);
                slDocument.SetCellValue(16, 1, "Person submitting the monthly report");

                //Person submitting the monthly report
                slDocument.MergeWorksheetCells("A17", "B17", eachReportTitleStyle);
                slDocument.SetCellValue(17, 1, "First name");
                slDocument.MergeWorksheetCells("C17", "D17", columnDataStyle);
                slDocument.SetCellValue(17, 3, BRList.OMMACommercialLicenseHeaderData.FirstName);

                slDocument.MergeWorksheetCells("A18", "B18", eachReportTitleStyle);
                slDocument.SetCellValue(18, 1, "Last name");
                slDocument.MergeWorksheetCells("C18", "D18", columnDataStyle);
                slDocument.SetCellValue(18, 3, BRList.OMMACommercialLicenseHeaderData.LastName);

                slDocument.MergeWorksheetCells("A19", "B19", eachReportTitleStyle);
                slDocument.SetCellValue(19, 1, "Role");
                slDocument.MergeWorksheetCells("C19", "D19", columnDataStyle);
                slDocument.SetCellValue(19, 3, BRList.OMMACommercialLicenseHeaderData.Role);

                slDocument.MergeWorksheetCells("A20", "B20", eachReportTitleStyle);
                slDocument.SetCellValue(20, 1, "Email");
                slDocument.MergeWorksheetCells("C20", "D20", columnDataStyle);
                slDocument.SetCellValue(20, 3, BRList.OMMACommercialLicenseHeaderData.Email);

                slDocument.MergeWorksheetCells("A21", "B21", eachReportTitleStyle);
                slDocument.SetCellValue(21, 1, "Phone#");
                slDocument.MergeWorksheetCells("C21", "D21", columnDataStyle);
                slDocument.SetCellValue(21, 3, BRList.OMMACommercialLicenseHeaderData.PhoneNumber);

                int ReportingYear = BRList.OMMACommercialLicenseHeaderData.ReportingYear ?? 0;
                slDocument.MergeWorksheetCells("A22", "B22", eachReportTitleStyle);
                slDocument.SetCellValue(22, 1, "Reporting Year");
                slDocument.MergeWorksheetCells("C22", "D22", columnDataStyle);
                slDocument.SetCellValue(22, 3, ReportingYear.ToString());

                int ReportingMonth = BRList.OMMACommercialLicenseHeaderData.ReportingMonth ?? 0;
                slDocument.MergeWorksheetCells("A23", "B23", eachReportTitleStyle);
                slDocument.SetCellValue(23, 1, "Reporting Month");
                slDocument.MergeWorksheetCells("C23", "D23", columnDataStyle);
                slDocument.SetCellValue(23, 3, ReportingMonth.ToString());
            }

            int rowHeaderIndex = 26;

            var reportNames = BRList.CommercialLicenseMonthlyReport.GroupBy(a => a.ReportName).Select(a => new
            {
                ReportName = a.Key,
                ReportDisplayName = a.Min(x => x.ReportDisplayName)
            }).ToList();

            foreach (var rName in reportNames)
            {
                rowHeaderIndex = rowHeaderIndex + 2;
                slDocument.MergeWorksheetCells("A" + rowHeaderIndex, "I" + rowHeaderIndex, eachReportTitleStyle);
                slDocument.SetCellValue(rowHeaderIndex, 1, rName.ReportDisplayName);
                rowHeaderIndex = rowHeaderIndex + 1;

                if (rName.ReportName == "CannabisOnHandBeginning"
                    || rName.ReportName == "PurchasedFromGrowerLicensees"
                    || rName.ReportName == "PurchasedFromProcessorLicensees"
                    || rName.ReportName == "MedicalManufacturedOrProcessed")
                {
                    //Set column header.
                    slDocument.SetCellValue(rowHeaderIndex, 1, "Category");
                    slDocument.SetCellStyle(rowHeaderIndex, 1, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 2, "Weight (lb 0.00)");
                    slDocument.SetCellStyle(rowHeaderIndex, 2, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 3, "Count (smallest unit sold)");
                    slDocument.SetCellStyle(rowHeaderIndex, 3, columnHeadingStyle);
                }

                if (rName.ReportName == "SoldToDispensaryProcessorResearcherLicensees")
                {
                    slDocument.SetCellValue(rowHeaderIndex, 1, "");
                    slDocument.SetCellStyle(rowHeaderIndex, 1, columnHeadingStyle);

                    slDocument.MergeWorksheetCells("B" + rowHeaderIndex, "C" + rowHeaderIndex, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 2, "DISPENSARY");

                    slDocument.MergeWorksheetCells("D" + rowHeaderIndex, "E" + rowHeaderIndex, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 4, "PROCESSOR");

                    slDocument.MergeWorksheetCells("F" + rowHeaderIndex, "G" + rowHeaderIndex, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 6, "RESEARCHER");

                    slDocument.MergeWorksheetCells("H" + rowHeaderIndex, "I" + rowHeaderIndex, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 8, "TOTAL");

                    rowHeaderIndex = rowHeaderIndex + 1;

                    slDocument.SetCellValue(rowHeaderIndex, 1, "Category");
                    slDocument.SetCellStyle(rowHeaderIndex, 1, columnHeadingStyle);

                    slDocument.SetCellValue(rowHeaderIndex, 2, "Weight (lb 0.00)");
                    slDocument.SetCellStyle(rowHeaderIndex, 2, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 3, "Count (smallest unit sold)");
                    slDocument.SetCellStyle(rowHeaderIndex, 3, columnHeadingStyle);

                    slDocument.SetCellValue(rowHeaderIndex, 4, "Weight (lb 0.00)");
                    slDocument.SetCellStyle(rowHeaderIndex, 4, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 5, "Count (smallest unit sold)");
                    slDocument.SetCellStyle(rowHeaderIndex, 5, columnHeadingStyle);

                    slDocument.SetCellValue(rowHeaderIndex, 6, "Weight (lb 0.00)");
                    slDocument.SetCellStyle(rowHeaderIndex, 6, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 7, "Count (smallest unit sold)");
                    slDocument.SetCellStyle(rowHeaderIndex, 7, columnHeadingStyle);

                    slDocument.SetCellValue(rowHeaderIndex, 8, "Weight (lb 0.00)");
                    slDocument.SetCellStyle(rowHeaderIndex, 8, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 9, "Count (smallest unit sold)");
                    slDocument.SetCellStyle(rowHeaderIndex, 9, columnHeadingStyle);

                    rowHeaderIndex = rowHeaderIndex + 1;
                    foreach (var item in sList)
                    {
                        columnDataStyle.Alignment.Horizontal = HorizontalAlignmentValues.Left;
                        slDocument.SetCellValue(rowHeaderIndex + 1, 1, item.CategoryDescription);
                        slDocument.SetCellStyle(rowHeaderIndex + 1, 1, columnDataStyle);

                        columnDataStyle.Alignment.Horizontal = HorizontalAlignmentValues.Right;
                        slDocument.SetCellValue(rowHeaderIndex + 1, 2, item.QuantityWeightBased1);
                        slDocument.SetCellStyle(rowHeaderIndex + 1, 2, columnDataStyle);
                        columnDataStyle.Alignment.Horizontal = HorizontalAlignmentValues.Right;
                        slDocument.SetCellValue(rowHeaderIndex + 1, 3, item.QuantityCountBased1);
                        slDocument.SetCellStyle(rowHeaderIndex + 1, 3, columnDataStyle);

                        columnDataStyle.Alignment.Horizontal = HorizontalAlignmentValues.Right;
                        slDocument.SetCellValue(rowHeaderIndex + 1, 4, item.QuantityWeightBased2);
                        slDocument.SetCellStyle(rowHeaderIndex + 1, 4, columnDataStyle);
                        columnDataStyle.Alignment.Horizontal = HorizontalAlignmentValues.Right;
                        slDocument.SetCellValue(rowHeaderIndex + 1, 5, item.QuantityCountBased2);
                        slDocument.SetCellStyle(rowHeaderIndex + 1, 5, columnDataStyle);

                        columnDataStyle.Alignment.Horizontal = HorizontalAlignmentValues.Right;
                        slDocument.SetCellValue(rowHeaderIndex + 1, 6, item.QuantityWeightBased3);
                        slDocument.SetCellStyle(rowHeaderIndex + 1, 6, columnDataStyle);
                        columnDataStyle.Alignment.Horizontal = HorizontalAlignmentValues.Right;
                        slDocument.SetCellValue(rowHeaderIndex + 1, 7, item.QuantityCountBased3);
                        slDocument.SetCellStyle(rowHeaderIndex + 1, 7, columnDataStyle);

                        columnDataStyle.Alignment.Horizontal = HorizontalAlignmentValues.Right;
                        slDocument.SetCellValue(rowHeaderIndex + 1, 8, item.QuantityWeightTotal);
                        slDocument.SetCellStyle(rowHeaderIndex + 1, 8, columnDataStyle);
                        columnDataStyle.Alignment.Horizontal = HorizontalAlignmentValues.Right;
                        slDocument.SetCellValue(rowHeaderIndex + 1, 9, item.QuantityCountTotal);
                        slDocument.SetCellStyle(rowHeaderIndex + 1, 9, columnDataStyle);
                        rowHeaderIndex++;
                    }
                }

                if (rName.ReportName == "TransportedOut"
                    || rName.ReportName == "TransportedIn")
                {
                    //Set column header.
                    slDocument.SetCellValue(rowHeaderIndex, 1, "Category");
                    slDocument.SetCellStyle(rowHeaderIndex, 1, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 2, "Weight (lb 0.00)");
                    slDocument.SetCellStyle(rowHeaderIndex, 2, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 3, "Count (smallest unit sold)");
                    slDocument.SetCellStyle(rowHeaderIndex, 3, columnHeadingStyle);
                }

                if (rName.ReportName == "TransporterIDs")
                {
                    slDocument.SetCellValue(rowHeaderIndex, 1, "Transporters");
                    slDocument.SetCellStyle(rowHeaderIndex, 1, columnHeadingStyle);

                    foreach (var item in BRList.CommercialLicenseMonthlyReport)
                    {
                        if (item.ReportName == rName.ReportName)
                        {
                            slDocument.SetCellValue(rowHeaderIndex + 1, 1, item.LicenseNumber);
                            slDocument.SetCellStyle(rowHeaderIndex + 1, 1, columnDataStyle);
                            rowHeaderIndex++;
                        }
                    }
                }

                if (rName.ReportName == "CannabisOnHandEnd")
                {
                    //Set column header.
                    slDocument.SetCellValue(rowHeaderIndex, 1, "Category");
                    slDocument.SetCellStyle(rowHeaderIndex, 1, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 2, "Weight (lb 0.00)");
                    slDocument.SetCellStyle(rowHeaderIndex, 2, columnHeadingStyle);
                    slDocument.SetCellValue(rowHeaderIndex, 3, "Count (smallest unit sold)");
                    slDocument.SetCellStyle(rowHeaderIndex, 3, columnHeadingStyle);
                }

                if (rName.ReportName != "SoldToDispensaryProcessorResearcherLicensees"
                    && rName.ReportName != "TransporterIDs")
                {
                    foreach (var item in BRList.CommercialLicenseMonthlyReport)
                    {
                        if (item.ReportName == rName.ReportName)
                        {
                            columnDataStyle.Alignment.Horizontal = HorizontalAlignmentValues.Left;
                            slDocument.SetCellValue(rowHeaderIndex + 1, 1, item.CategoryDescription);
                            slDocument.SetCellStyle(rowHeaderIndex + 1, 1, columnDataStyle);
                            columnDataStyle.Alignment.Horizontal = HorizontalAlignmentValues.Right;
                            slDocument.SetCellValue(rowHeaderIndex + 1, 2, Math.Round(item.QuantityWeightBased, 2).ToString("F2"));
                            slDocument.SetCellStyle(rowHeaderIndex + 1, 2, columnDataStyle);
                            columnDataStyle.Alignment.Horizontal = HorizontalAlignmentValues.Right;
                            slDocument.SetCellValue(rowHeaderIndex + 1, 3, Math.Round(item.QuantityCountBased, 0));
                            slDocument.SetCellStyle(rowHeaderIndex + 1, 3, columnDataStyle);
                            rowHeaderIndex++;
                        }
                    }
                }
            }

            //--------------------Save File Start----------------------------------

            if (System.IO.File.Exists(filename))
            {
                System.IO.File.Delete(filename);
            }
            //---AutoFit Start---
            slDocument.AutoFitColumn(1, 9);
            slDocument.AutoFitRow(1);
            //---AutoFit End---
            slDocument.RenameWorksheet(SLDocument.DefaultFirstSheetName, "OMMA Commercial License Report");
            SLPageSettings ps = slDocument.GetPageSettings();
            //---page view Setting Start---
            ps.Orientation = OrientationValues.Landscape;
            ps.PaperSize = SLPaperSizeValues.A4Paper;
            // 83% of normal page size
            ps.ScalePage(83);
            //---page view Setting End---
            //--- footer setting Start---
            ps.SetLeftFooterText("&[File]  /  &[Tab]");
            ps.SetCenterFooterText("&[Page] of &[Pages]");
            ps.SetRightFooterText("&[Date]");
            //--- footer setting End--
            //---Margin setting start---
            ps.TopMargin = 0.236;
            ps.LeftMargin = 0.25;
            ps.BottomMargin = 0.44;
            ps.FooterMargin = 0.157;
            ps.RightMargin = 0.25;
            ps.HeaderMargin = 0.118;
            //---margin Setting End---

            //--- Grid Line Setting Start---
            ps.PrintGridLines = true;
            ps.ShowGridLines = true;
            //--- Grid Line Setting End---

            //---Zooming setting Start---
            ps.ZoomScale = 75;
            //---Zooming setting End---

            ps.PageOrder = PageOrderValues.DownThenOver;

            //---Sheet Setting End---
            slDocument.SetPageSettings(ps);
            //-------------------Page Layout setting End-----------------------------------
            slDocument.SaveAs(filename);

            strvalue = new string[] { strFileName, FolderName };
            return strvalue;
        }

        #endregion

        #region Common Method For Pdf Report

        public string[] CommonPdfReportDownload(string[] HeaderVal, DataTable dt, object[] SearchHeader, object[] strSearchParam, string strReportName, string[] rightAlignColumns, string[] AllColumnWithHidden = null)
        {
            string[] strvalue = null;
            string FolderName = DateTime.Now.ToString("dd-MM-yyyy") + "_Report";
            string strFileName = string.Empty;
            string path = HttpContext.Current.Server.MapPath("~/Upload/Pdf/" + FolderName);
            string filename = string.Empty;
            if (!Directory.Exists(path))
                Directory.CreateDirectory(path);

            strFileName = strReportName + "_" + DateTime.Now.ToString("ddMMyyyyHHMMss") + ".pdf";
            filename = path + "\\" + strFileName;

            if (System.IO.File.Exists(filename))
            {
                System.IO.File.Delete(filename);
            }

            FileStream fs = new FileStream(filename, FileMode.Create, FileAccess.Write, FileShare.None);

            Document doc = null;
            if (HeaderVal.Length > 20)
                doc = new Document(PageSize.A0, 18, 18, 36, 18);  //72 points = 1 inch
            else if (HeaderVal.Length > 15)
                doc = new Document(PageSize.A1, 18, 18, 36, 18);  //72 points = 1 inch
            else if (HeaderVal.Length > 10)
                doc = new Document(PageSize.A2, 18, 18, 36, 18);  //72 points = 1 inch
            else if (HeaderVal.Length > 6)
                doc = new Document(PageSize.A3, 18, 18, 36, 18);  //72 points = 1 inch
            else
                doc = new Document(PageSize.A4, 18, 18, 36, 18);  //72 points = 1 inch

            PdfWriter writer = PdfWriter.GetInstance(doc, fs);

            Header header = new Header();
            header.Title = strReportName;
            writer.PageEvent = header;
            doc.Open();
            if (SearchHeader != null)
            {
                PdfPTable filterTable = new PdfPTable(SearchHeader.Length);
                filterTable.WidthPercentage = 100;

                Chunk filterChunk = new Chunk("Filter:", FontFactory.GetFont("Arial", 11, Font.BOLD, BaseColor.BLACK));
                PdfPCell filterCell = new PdfPCell(new Phrase(filterChunk));

                filterCell.HorizontalAlignment = PdfPCell.ALIGN_LEFT;
                filterCell.VerticalAlignment = PdfPCell.ALIGN_CENTER;
                filterCell.Colspan = SearchHeader.Length;
                filterCell.PaddingBottom = 5;
                filterCell.PaddingTop = 5;
                filterTable.AddCell(filterCell);
                filterTable.SpacingAfter = 20;

                //Set filter columns names in the pdf file
                for (int k = 0; k < SearchHeader.Length; k++)
                {
                    Chunk chunk = new Chunk(Convert.ToString(SearchHeader[k]), FontFactory.GetFont("Arial", 11, Font.BOLD, BaseColor.BLACK));
                    PdfPCell cell = new PdfPCell(new Phrase(chunk));

                    cell.HorizontalAlignment = PdfPCell.ALIGN_LEFT;
                    cell.VerticalAlignment = PdfPCell.ALIGN_CENTER;
                    cell.PaddingTop = 5;
                    cell.PaddingBottom = 5;
                    filterTable.AddCell(cell);
                }

                //Set filter columns value in the pdf file
                for (int k = 0; k < strSearchParam.Length; k++)
                {
                    Chunk chunk = new Chunk(Convert.ToString(strSearchParam[k]), FontFactory.GetFont("Arial", 9, Font.NORMAL, BaseColor.BLACK));
                    PdfPCell cell = new PdfPCell(new Phrase(chunk));

                    cell.HorizontalAlignment = PdfPCell.ALIGN_LEFT;
                    cell.VerticalAlignment = PdfPCell.ALIGN_CENTER;
                    cell.PaddingTop = 5;
                    cell.PaddingBottom = 5;
                    filterTable.AddCell(cell);
                }

                doc.Add(filterTable);
            }
            PdfPTable table = new PdfPTable(HeaderVal.Length);
            table.WidthPercentage = 100;

            //Set columns names in the pdf file
            for (int k = 0; k < HeaderVal.Length; k++)
            {
                Chunk chunk = new Chunk(HeaderVal[k], FontFactory.GetFont("Arial", 11, Font.BOLD, BaseColor.BLACK));
                PdfPCell cell = new PdfPCell(new Phrase(chunk));

                cell.HorizontalAlignment = PdfPCell.ALIGN_CENTER;
                cell.VerticalAlignment = PdfPCell.ALIGN_CENTER;
                table.AddCell(cell);
            }

            string FirstColName = HeaderVal[0];
            if (FirstColName.ToLower() != "tenant name")
            {
                if (rightAlignColumns != null)
                {
                    for (int i = 0; i < rightAlignColumns.Length; i++)
                    {
                        rightAlignColumns[i] = Convert.ToString(Convert.ToInt32(rightAlignColumns[i]) - 2);
                    }
                }
            }
            else if (FirstColName.ToLower() == "tenant name")
            {
                if (rightAlignColumns != null)
                {
                    for (int i = 0; i < rightAlignColumns.Length; i++)
                    {
                        rightAlignColumns[i] = Convert.ToString(Convert.ToInt32(rightAlignColumns[i]) - 1);
                    }
                }
            }

            //Add values of DataTable in pdf file
            for (int i = 0; i < dt.Rows.Count; i++)
            {
                for (int j = 0; j < dt.Columns.Count; j++)
                {
                    if (AllColumnWithHidden != null)
                    {
                        if (HeaderVal.Any(x => x == AllColumnWithHidden[j]))
                        {
                            Chunk chunkVal = new Chunk(dt.Rows[i][j].ToString(), FontFactory.GetFont("Arial", 9, Font.NORMAL, BaseColor.BLACK));

                            PdfPCell cell = new PdfPCell(new Phrase(chunkVal));
                            cell.VerticalAlignment = PdfPCell.ALIGN_CENTER;

                            if (rightAlignColumns != null)
                            {
                                var result = rightAlignColumns.Where(x => x == j.ToString()).SingleOrDefault();
                                if (!string.IsNullOrEmpty(result))
                                    cell.HorizontalAlignment = PdfPCell.ALIGN_RIGHT;
                                else
                                    cell.HorizontalAlignment = PdfPCell.ALIGN_LEFT;
                            }
                            else
                                cell.HorizontalAlignment = PdfPCell.ALIGN_LEFT;

                            table.AddCell(cell);
                        }
                    }
                    else
                    {
                        Chunk chunkVal = new Chunk(dt.Rows[i][j].ToString(), FontFactory.GetFont("Arial", 9, Font.NORMAL, BaseColor.BLACK));

                        PdfPCell cell = new PdfPCell(new Phrase(chunkVal));
                        cell.VerticalAlignment = PdfPCell.ALIGN_CENTER;

                        if (rightAlignColumns != null)
                        {
                            var result = rightAlignColumns.Where(x => x == j.ToString()).SingleOrDefault();
                            if (!string.IsNullOrEmpty(result))
                                cell.HorizontalAlignment = PdfPCell.ALIGN_RIGHT;
                            else
                                cell.HorizontalAlignment = PdfPCell.ALIGN_LEFT;
                        }
                        else
                            cell.HorizontalAlignment = PdfPCell.ALIGN_LEFT;

                        table.AddCell(cell);
                    }
                }
            }

            doc.Add(table);
            doc.Close();
            //--------------------Save File Start----------------------------------

            PdfWriter.GetInstance(doc, fs);

            strvalue = new string[] { strFileName, FolderName };
            return strvalue;
        }

        public string[] PdfReportDownloadForOMMAReport(object[] SearchHeader, object[] strSearchParam, string strReportName, CommercialLicenseMonthlyReportListModel BRList = null, List<CommercialLicenseMonthlyReportForSaleModel> sList = null)
        {
            string[] strvalue = null;
            string FolderName = DateTime.Now.ToString("dd-MM-yyyy") + "_Report";
            string strFileName = string.Empty;
            string path = HttpContext.Current.Server.MapPath("~/Upload/Pdf/" + FolderName);
            string filename = string.Empty;
            if (!Directory.Exists(path))
                Directory.CreateDirectory(path);

            strFileName = strReportName + "_" + DateTime.Now.ToString("ddMMyyyyHHMMss") + ".pdf";
            filename = path + "\\" + strFileName;

            if (System.IO.File.Exists(filename))
            {
                System.IO.File.Delete(filename);
            }

            FileStream fs = new FileStream(filename, FileMode.Create, FileAccess.Write, FileShare.None);

            Document doc = new Document(PageSize.A4, 18, 18, 36, 18);  //72 points = 1 inch

            PdfWriter writer = PdfWriter.GetInstance(doc, fs);

            Header header = new Header();
            header.Title = strReportName;
            writer.PageEvent = header;
            doc.Open();

            PdfPTable filterTable = new PdfPTable(SearchHeader.Length);
            filterTable.WidthPercentage = 100;

            Chunk filterChunk = new Chunk("Filter:", FontFactory.GetFont("Arial", 11, Font.BOLD, BaseColor.BLACK));
            PdfPCell filterCell = new PdfPCell(new Phrase(filterChunk));

            filterCell.HorizontalAlignment = PdfPCell.ALIGN_LEFT;
            filterCell.VerticalAlignment = PdfPCell.ALIGN_CENTER;
            filterCell.Colspan = SearchHeader.Length;
            filterCell.PaddingBottom = 5;
            filterCell.PaddingTop = 5;
            filterTable.AddCell(filterCell);
            filterTable.SpacingAfter = 20;

            //Set filter columns names in the pdf file
            for (int k = 0; k < SearchHeader.Length; k++)
            {
                Chunk chunk = new Chunk(Convert.ToString(SearchHeader[k]), FontFactory.GetFont("Arial", 11, Font.BOLD, BaseColor.BLACK));
                PdfPCell cell = new PdfPCell(new Phrase(chunk));

                cell.HorizontalAlignment = PdfPCell.ALIGN_CENTER;
                cell.VerticalAlignment = PdfPCell.ALIGN_CENTER;
                cell.PaddingTop = 5;
                cell.PaddingBottom = 5;
                filterTable.AddCell(cell);
            }

            //Set filter columns value in the pdf file
            for (int k = 0; k < strSearchParam.Length; k++)
            {
                Chunk chunk = new Chunk(Convert.ToString(strSearchParam[k]), FontFactory.GetFont("Arial", 9, Font.NORMAL, BaseColor.BLACK));
                PdfPCell cell = new PdfPCell(new Phrase(chunk));

                cell.HorizontalAlignment = PdfPCell.ALIGN_CENTER;
                cell.VerticalAlignment = PdfPCell.ALIGN_CENTER;
                cell.PaddingTop = 5;
                cell.PaddingBottom = 5;
                filterTable.AddCell(cell);
            }

            doc.Add(filterTable);

            #region Licensee Information
            if (BRList.OMMACommercialLicenseHeaderData != null)
            {
                PdfPTable liTable = new PdfPTable(2);
                liTable.WidthPercentage = 100;

                PdfPCell c1 = GetPdfHeaderCell("Licensee Information");
                c1.Colspan = 2;
                liTable.AddCell(c1);

                liTable.AddCell(GetPdfHeaderCell("License Type"));
                liTable.AddCell(GetPdfDataCell(BRList.OMMACommercialLicenseHeaderData.LicenseType));

                liTable.AddCell(GetPdfHeaderCell("OMMA License ID/Number"));
                liTable.AddCell(GetPdfDataCell(BRList.OMMACommercialLicenseHeaderData.OMMALicenseNumber));

                liTable.AddCell(GetPdfHeaderCell("OBNDD Registration Number"));
                liTable.AddCell(GetPdfDataCell(BRList.OMMACommercialLicenseHeaderData.OBNDDRegistrationNumber));

                liTable.AddCell(GetPdfHeaderCell("Tax ID Number"));
                liTable.AddCell(GetPdfDataCell(BRList.OMMACommercialLicenseHeaderData.TaxIDNumber));

                liTable.AddCell(GetPdfHeaderCell("Food License Number"));
                liTable.AddCell(GetPdfDataCell(BRList.OMMACommercialLicenseHeaderData.FoodLicenseNumber));

                liTable.AddCell(GetPdfHeaderCell("Entity Name"));
                liTable.AddCell(GetPdfDataCell(BRList.OMMACommercialLicenseHeaderData.EntityName));

                PdfPCell c2 = GetPdfHeaderCell("Person submitting the monthly report");
                c2.Colspan = 2;
                liTable.AddCell(c2);

                //Person submitting the monthly report
                liTable.AddCell(GetPdfHeaderCell("First name"));
                liTable.AddCell(GetPdfDataCell(BRList.OMMACommercialLicenseHeaderData.FirstName));

                liTable.AddCell(GetPdfHeaderCell("Last name"));
                liTable.AddCell(GetPdfDataCell(BRList.OMMACommercialLicenseHeaderData.LastName));

                liTable.AddCell(GetPdfHeaderCell("Role"));
                liTable.AddCell(GetPdfDataCell(BRList.OMMACommercialLicenseHeaderData.Role));

                liTable.AddCell(GetPdfHeaderCell("Email"));
                liTable.AddCell(GetPdfDataCell(BRList.OMMACommercialLicenseHeaderData.Email));

                liTable.AddCell(GetPdfHeaderCell("Phone#"));
                liTable.AddCell(GetPdfDataCell(BRList.OMMACommercialLicenseHeaderData.PhoneNumber));

                int ReportingYear = BRList.OMMACommercialLicenseHeaderData.ReportingYear ?? 0;
                liTable.AddCell(GetPdfHeaderCell("Reporting Year"));
                liTable.AddCell(GetPdfDataCell(ReportingYear.ToString()));

                int ReportingMonth = BRList.OMMACommercialLicenseHeaderData.ReportingMonth ?? 0;
                liTable.AddCell(GetPdfHeaderCell("Reporting Month"));
                liTable.AddCell(GetPdfDataCell(ReportingMonth.ToString()));

                doc.Add(liTable);
            }
            #endregion

            var reportNames = BRList.CommercialLicenseMonthlyReport.GroupBy(a => a.ReportName).Select(a => new
            {
                ReportName = a.Key,
                ReportDisplayName = a.Min(x => x.ReportDisplayName)
            }).ToList();

            foreach (var rName in reportNames)
            {
                PdfPTable table3C = new PdfPTable(3);
                table3C.WidthPercentage = 100;

                PdfPTable table1_1C = new PdfPTable(1);
                table1_1C.WidthPercentage = 100;
                table1_1C.AddCell(GetPdfHeaderCell(" "));
                table1_1C.AddCell(GetPdfHeaderCell(rName.ReportDisplayName));
                doc.Add(table1_1C);

                if (rName.ReportName == "CannabisOnHandBeginning"
                    || rName.ReportName == "PurchasedFromGrowerLicensees"
                    || rName.ReportName == "PurchasedFromProcessorLicensees"
                    || rName.ReportName == "MedicalManufacturedOrProcessed")
                {
                    table3C.AddCell(GetPdfHeaderCell("Category"));
                    table3C.AddCell(GetPdfHeaderCell("Weight (lb 0.00)", PdfPCell.ALIGN_CENTER));
                    table3C.AddCell(GetPdfHeaderCell("Count (smallest unit sold)", PdfPCell.ALIGN_CENTER));
                }

                if (rName.ReportName == "SoldToDispensaryProcessorResearcherLicensees")
                {
                    PdfPTable table9C = new PdfPTable(9);
                    table9C.WidthPercentage = 100;

                    table9C.AddCell(GetPdfHeaderCell(""));

                    var c2 = GetPdfHeaderCell("DISPENSARY", PdfPCell.ALIGN_CENTER);
                    c2.Colspan = 2;
                    table9C.AddCell(c2);
                    var c3 = GetPdfHeaderCell("PROCESSOR", PdfPCell.ALIGN_CENTER);
                    c3.Colspan = 2;
                    table9C.AddCell(c3);
                    var c4 = GetPdfHeaderCell("RESEARCHER", PdfPCell.ALIGN_CENTER);
                    c4.Colspan = 2;
                    table9C.AddCell(c4);
                    var c5 = GetPdfHeaderCell("TOTAL", PdfPCell.ALIGN_CENTER);
                    c5.Colspan = 2;
                    table9C.AddCell(c5);

                    table9C.AddCell(GetPdfHeaderCell("Category"));
                    table9C.AddCell(GetPdfHeaderCell("Weight (lb 0.00)", PdfPCell.ALIGN_CENTER));
                    table9C.AddCell(GetPdfHeaderCell("Count (smallest unit sold)", PdfPCell.ALIGN_CENTER));
                    table9C.AddCell(GetPdfHeaderCell("Weight (lb 0.00)", PdfPCell.ALIGN_CENTER));
                    table9C.AddCell(GetPdfHeaderCell("Count (smallest unit sold)", PdfPCell.ALIGN_CENTER));
                    table9C.AddCell(GetPdfHeaderCell("Weight (lb 0.00)", PdfPCell.ALIGN_CENTER));
                    table9C.AddCell(GetPdfHeaderCell("Count (smallest unit sold)", PdfPCell.ALIGN_CENTER));
                    table9C.AddCell(GetPdfHeaderCell("Weight (lb 0.00)", PdfPCell.ALIGN_CENTER));
                    table9C.AddCell(GetPdfHeaderCell("Count (smallest unit sold)", PdfPCell.ALIGN_CENTER));

                    foreach (var item in sList)
                    {
                        table9C.AddCell(GetPdfDataCell(item.CategoryDescription));

                        table9C.AddCell(GetPdfDataCell(item.QuantityWeightBased1.ToString(), PdfPCell.ALIGN_CENTER));
                        table9C.AddCell(GetPdfDataCell(item.QuantityCountBased1.ToString(), PdfPCell.ALIGN_CENTER));

                        table9C.AddCell(GetPdfDataCell(item.QuantityWeightBased2.ToString(), PdfPCell.ALIGN_CENTER));
                        table9C.AddCell(GetPdfDataCell(item.QuantityCountBased2.ToString(), PdfPCell.ALIGN_CENTER));

                        table9C.AddCell(GetPdfDataCell(item.QuantityWeightBased3.ToString(), PdfPCell.ALIGN_CENTER));
                        table9C.AddCell(GetPdfDataCell(item.QuantityCountBased3.ToString(), PdfPCell.ALIGN_CENTER));

                        table9C.AddCell(GetPdfDataCell(item.QuantityWeightTotal.ToString(), PdfPCell.ALIGN_CENTER));
                        table9C.AddCell(GetPdfDataCell(item.QuantityCountTotal.ToString(), PdfPCell.ALIGN_CENTER));
                    }

                    doc.Add(table9C);
                }

                if (rName.ReportName == "TransportedOut"
                    || rName.ReportName == "TransportedIn")
                {
                    table3C.AddCell(GetPdfHeaderCell("Category"));
                    table3C.AddCell(GetPdfHeaderCell("Weight (lb 0.00)", PdfPCell.ALIGN_CENTER));
                    table3C.AddCell(GetPdfHeaderCell("Count (smallest unit sold)", PdfPCell.ALIGN_CENTER));
                }

                if (rName.ReportName == "TransporterIDs")
                {
                    PdfPTable table1C = new PdfPTable(1);
                    table1C.WidthPercentage = 100;

                    table1C.AddCell(GetPdfHeaderCell("Transporters"));
                    foreach (var item in BRList.CommercialLicenseMonthlyReport)
                    {
                        if (item.ReportName == rName.ReportName)
                        {
                            table1C.AddCell(GetPdfHeaderCell(item.LicenseNumber));
                        }
                    }
                    doc.Add(table1C);
                }

                if (rName.ReportName == "CannabisOnHandEnd")
                {
                    table3C.AddCell(GetPdfHeaderCell("Category"));
                    table3C.AddCell(GetPdfHeaderCell("Weight (lb 0.00)", PdfPCell.ALIGN_CENTER));
                    table3C.AddCell(GetPdfHeaderCell("Count (smallest unit sold)", PdfPCell.ALIGN_CENTER));
                }

                if (rName.ReportName != "SoldToDispensaryProcessorResearcherLicensees"
                    && rName.ReportName != "TransporterIDs")
                {
                    foreach (var item in BRList.CommercialLicenseMonthlyReport)
                    {
                        if (item.ReportName == rName.ReportName)
                        {
                            table3C.AddCell(GetPdfDataCell(item.CategoryDescription));
                            table3C.AddCell(GetPdfDataCell(Math.Round(item.QuantityWeightBased, 2).ToString("F2"), PdfPCell.ALIGN_CENTER));
                            table3C.AddCell(GetPdfDataCell(Math.Round(item.QuantityCountBased, 0).ToString(), PdfPCell.ALIGN_CENTER));
                        }
                    }
                    doc.Add(table3C);
                }
            }


            doc.Close();
            //--------------------Save File Start----------------------------------

            PdfWriter.GetInstance(doc, fs);

            strvalue = new string[] { strFileName, FolderName };
            return strvalue;
        }

        public PdfPCell GetPdfHeaderCell(string header, int horizontalAlignment = 0)
        {
            Chunk chunk = new Chunk(header, FontFactory.GetFont("Arial", 11, Font.BOLD, BaseColor.BLACK));
            PdfPCell cell = new PdfPCell(new Phrase(chunk));

            cell.HorizontalAlignment = horizontalAlignment;
            cell.VerticalAlignment = PdfPCell.ALIGN_CENTER;
            cell.PaddingTop = 5;
            cell.PaddingBottom = 5;
            return cell;
        }

        public PdfPCell GetPdfDataCell(string header, int horizontalAlignment = 0)
        {
            Chunk chunk = new Chunk(header, FontFactory.GetFont("Arial", 9, Font.NORMAL, BaseColor.BLACK));
            PdfPCell cell = new PdfPCell(new Phrase(chunk));

            cell.HorizontalAlignment = horizontalAlignment;
            cell.VerticalAlignment = PdfPCell.ALIGN_CENTER;
            cell.PaddingTop = 5;
            cell.PaddingBottom = 5;
            return cell;
        }

        #endregion Common Method For IIF Export

        public string[] ExportIIF<T>(List<T> lstData, string FileName, string FileType)
        {
            string[] strvalue = null;
            string FolderName = DateTime.Now.ToString("dd-MM-yyyy") + "_Report";
            string strFileName = string.Empty;
            string path = HttpContext.Current.Server.MapPath("~/Upload/IIF/" + FolderName);
            string filename = string.Empty;
            if (!Directory.Exists(path))
                Directory.CreateDirectory(path);

            strFileName = FileName + "_" + DateTime.Now.ToString("ddMMyyyyHHMMss") + ".iif";
            filename = path + "\\" + strFileName;

            if (System.IO.File.Exists(filename))
            {
                System.IO.File.Delete(filename);
            }
            StringBuilder body = new StringBuilder();
            switch (FileType)
            {
                case "ReceivePaymentFormat.iif":

                    using (StreamReader reader = new StreamReader(HttpContext.Current.Server.MapPath("~/Template/IIF/ReceivePaymentFormat.iif")))
                    {
                        body = body.Append(reader.ReadToEnd());
                        var lstQBPaymentDetailModel = lstData.Cast<QBPaymentDetailModel>().ToList();
                        foreach (var data in lstQBPaymentDetailModel)
                        {
                            body = body.Append("TRNS\t§TRNSID§\t§TRNSTYPE§\t§DATE§\t§ACCNT§\t§NAME§\t§AMOUNT§\t§DOCNUM§\r\n");
                            body = IIFBodyReplace(data, body, FileType);
                            body = body.Append("SPL\t§TRNSID§\t§TRNSTYPE§\t§DATE§\t§ACCNT§\t§NAME§\t§AMOUNT§\t§DOCNUM§\n");
                            body = IIFBodyReplace(data, body, FileType, true);
                            body = body.Append("ENDTRNS\t\t\t\t\t\t\t\r\n");
                        }

                    }

                    break;
                case "PurchaseOrderFormat.iif":
                    //Vendor List
                    var lstPOResult = lstData.Cast<QuickBooksPurchaseOrderIIFModel>().FirstOrDefault();

                    using (StreamReader reader = new StreamReader(HttpContext.Current.Server.MapPath("~/Template/IIF/POVendorFormat.iif")))
                    {

                        body = body.Append(reader.ReadToEnd());
                        foreach (var vendorDetails in lstPOResult.quickBooksPurchaseOrderIIFVendorModels)
                        {
                            body = body.Append("VEND\t§NAME§\t§REFNUM§\t§TIMESTAMP§\t§PRINTAS§\t§ADDR1§\t§ADDR2§\t§ADDR3§\t§ADDR4§\t§ADDR5§\t§VTYPE§\t§CONT1§\t§CONT2§\t§PHONE1§\t§PHONE2§\t§FAXNUM§\t§EMAIL§\t§NOTE§\t§TAXID§\t§LIMIT§\t§TERMS§\t§NOTEPAD§\t§SALUTATION§\t§COMPANYNAME§\t§FIRSTNAME§\t§MIDINIT§\t§LASTNAME§\t§CUSTFLD1§\t§CUSTFLD2§\t§CUSTFLD3§\t§CUSTFLD4§\t§CUSTFLD5§\t§CUSTFLD6§\t§CUSTFLD7§\t§CUSTFLD8§\t§CUSTFLD9§\t§CUSTFLD10§\t§CUSTFLD11§\t§CUSTFLD12§\t§CUSTFLD13§\t§CUSTFLD14§\t§CUSTFLD15§\t§1099§\t§HIDDEN§\t§DELCOUNT§\r\n");

                            body = IIFBodyReplace(vendorDetails, body, CommonEnum.IIFFileName.POVendorFormat.GetEnumStringValue());
                        }

                    }

                    //Purchase order List
                    using (StreamReader reader = new StreamReader(HttpContext.Current.Server.MapPath("~/Template/IIF/PurchaseOrderFormat.iif")))
                    {
                        body = body.Append(reader.ReadToEnd());
                        string APIURL = "Admin/getQuickBooksPOSOModeCodesByTenantID";
                        var APIResultsofTenant = CommonAPI.GetSync(APIURL).GetModelSync<TenantReferenceModel>();
                        foreach (var purchaseOrderDetails in lstPOResult.quickBooksPurchaseOrderListIIFModels)
                        {

                            QuickBooksPurchaseOrderListIIFModel estimatedTaxModel = new QuickBooksPurchaseOrderListIIFModel
                            {
                                Total = purchaseOrderDetails.EstimatedTax,
                                CPD = purchaseOrderDetails.CPD,
                                EstimatedTax = 0,
                                ExtendedPrice = purchaseOrderDetails.ExtendedPrice,
                                LineId = purchaseOrderDetails.LineId,
                                OrderDate = purchaseOrderDetails.OrderDate,
                                OrderDetailID = purchaseOrderDetails.OrderDetailID,
                                OrderID = purchaseOrderDetails.OrderID,
                                OtherAmount = 0,
                                Quantity = 0,
                                RPD = purchaseOrderDetails.RPD,
                                ShippingAmount = 0,
                                TRNTotal = 0,
                                UnitPrice = 0,
                                VendorName = "",
                                ItemName = APIResultsofTenant.Data.TaxReferenceNo
                            };

                            QuickBooksPurchaseOrderListIIFModel shippingModel = new QuickBooksPurchaseOrderListIIFModel
                            {
                                Total = purchaseOrderDetails.ShippingAmount,
                                CPD = purchaseOrderDetails.CPD,
                                EstimatedTax = 0,
                                ExtendedPrice = purchaseOrderDetails.ExtendedPrice,
                                LineId = purchaseOrderDetails.LineId,
                                OrderDate = purchaseOrderDetails.OrderDate,
                                OrderDetailID = purchaseOrderDetails.OrderDetailID,
                                OrderID = purchaseOrderDetails.OrderID,
                                OtherAmount = 0,
                                Quantity = 0,
                                RPD = purchaseOrderDetails.RPD,
                                ShippingAmount = 0,
                                TRNTotal = 0,
                                UnitPrice = 0,
                                VendorName = "",
                                ItemName = APIResultsofTenant.Data.ShippingReferenceNo
                            };
                            QuickBooksPurchaseOrderListIIFModel otherAmountModel = new QuickBooksPurchaseOrderListIIFModel
                            {
                                Total = purchaseOrderDetails.OtherAmount,
                                CPD = purchaseOrderDetails.CPD,
                                EstimatedTax = 0,
                                ExtendedPrice = purchaseOrderDetails.ExtendedPrice,
                                LineId = purchaseOrderDetails.LineId,
                                OrderDate = purchaseOrderDetails.OrderDate,
                                OrderDetailID = purchaseOrderDetails.OrderDetailID,
                                OrderID = purchaseOrderDetails.OrderID,
                                OtherAmount = 0,
                                Quantity = 0,
                                RPD = purchaseOrderDetails.RPD,
                                ShippingAmount = 0,
                                TRNTotal = 0,
                                UnitPrice = 0,
                                VendorName = "",
                                ItemName = APIResultsofTenant.Data.OtherReferenceNo
                            };
                            purchaseOrderDetails.TRNTotal = purchaseOrderDetails.Total + otherAmountModel.Total + shippingModel.Total + estimatedTaxModel.Total;
                            body = body.Append("TRNS\t§TRNSID§\t§TRNSTYPE§\t§DATE§\t§ACCNT§\t§NAME§\t§CLASS§\t§AMOUNT§\t§DOCNUM§\t§MEMO§\t§CLEAR§\t§TOPRINT§\t§NAMEISTAXABLE§\t§ADDR1§\t§ADDR2§\t§ADDR3§\t§ADDR4§\t§ADDR5§\t§DUEDATE§\t§TERMS§\t§PAID§\t§PAYMETH§\t§SHIPVIA§\t§SHIPDATE§\t§OTHER1§\t§REP§\t§FOB§\t§PONUM§\t§INVTITLE§\t§INVMEMO§\t§SADDR1§\t§SADDR2§\t§SADDR3§\t§SADDR4§\t§SADDR5§\t\t\t\t\t\t\t\t\t\t\r\n");

                            body = IIFBodyReplace(purchaseOrderDetails, body, FileType);

                            body = body.Append("SPL\t§SPLID§\t§TRNSTYPE§\t§DATE§\t§ACCNT§\t§NAME§\t§CLASS§\t§AMOUNT§\t§DOCNUM§\t§MEMO§\t§CLEAR§\t§QNTY§\t§PRICE§\t§INVITEM§\t§PAYMETH§\t§TAXABLE§\t§VALADJ§\t§REIMBEXP§\t§SERVICEDATE§\t§OTHER2§\t§OTHER3§\t§PAYITEM§\t§YEARTODATE§\t§WAGEBASE§\t§EXTRA§\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n");

                            body = IIFBodyReplace(purchaseOrderDetails, body, FileType, true);

                            body = body.Append("SPL\t§SPLID§\t§TRNSTYPE§\t§DATE§\t§ACCNT§\t§NAME§\t§CLASS§\t§AMOUNT§\t§DOCNUM§\t§MEMO§\t§CLEAR§\t§QNTY§\t§PRICE§\t§INVITEM§\t§PAYMETH§\t§TAXABLE§\t§VALADJ§\t§REIMBEXP§\t§SERVICEDATE§\t§OTHER2§\t§OTHER3§\t§PAYITEM§\t§YEARTODATE§\t§WAGEBASE§\t§EXTRA§\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n");

                            body = IIFBodyReplace(estimatedTaxModel, body, FileType, true);

                            body = body.Append("SPL\t§SPLID§\t§TRNSTYPE§\t§DATE§\t§ACCNT§\t§NAME§\t§CLASS§\t§AMOUNT§\t§DOCNUM§\t§MEMO§\t§CLEAR§\t§QNTY§\t§PRICE§\t§INVITEM§\t§PAYMETH§\t§TAXABLE§\t§VALADJ§\t§REIMBEXP§\t§SERVICEDATE§\t§OTHER2§\t§OTHER3§\t§PAYITEM§\t§YEARTODATE§\t§WAGEBASE§\t§EXTRA§\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n");

                            body = IIFBodyReplace(shippingModel, body, FileType, true);

                            body = body.Append("SPL\t§SPLID§\t§TRNSTYPE§\t§DATE§\t§ACCNT§\t§NAME§\t§CLASS§\t§AMOUNT§\t§DOCNUM§\t§MEMO§\t§CLEAR§\t§QNTY§\t§PRICE§\t§INVITEM§\t§PAYMETH§\t§TAXABLE§\t§VALADJ§\t§REIMBEXP§\t§SERVICEDATE§\t§OTHER2§\t§OTHER3§\t§PAYITEM§\t§YEARTODATE§\t§WAGEBASE§\t§EXTRA§\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n");

                            body = IIFBodyReplace(otherAmountModel, body, FileType, true);

                            body = body.Append("ENDTRNS\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n");
                        }

                    }
                    break;
                case "SalesInvoiceFormat.iif":

                    using (StreamReader reader = new StreamReader(HttpContext.Current.Server.MapPath("~/Template/IIF/SalesInvoiceFormat.iif")))
                    {
                        body = body.Append(reader.ReadToEnd());
                        var lstQBInvoiceDetailModel = lstData.Cast<QBSalesInvoiceExportIIFModel>().ToList();
                        var grpQBInvoiceDetailModel = lstQBInvoiceDetailModel.GroupBy(x => x.OrderID).ToList();
                        string APIURL = "Admin/getQuickBooksPOSOModeCodesByTenantID";
                        var APIResultsofTenant = CommonAPI.GetSync(APIURL).GetModelSync<TenantReferenceModel>();
                        foreach (var data in grpQBInvoiceDetailModel)
                        {
                            QBSalesInvoiceExportIIFModel objQBSalesInvoiceExportIIFModel = data.FirstOrDefault();

                            lstQBInvoiceDetailModel = data.ToList();
                            lstQBInvoiceDetailModel.Add(new QBSalesInvoiceExportIIFModel
                            {
                                OrderID = objQBSalesInvoiceExportIIFModel.OrderID,
                                UnitPrice = 0,
                                DiscountAmount = 0,
                                OtherAmount = 0,
                                ShippingAmount = 0,
                                AccountingOrderID = objQBSalesInvoiceExportIIFModel.AccountingOrderID,
                                CustomerName = objQBSalesInvoiceExportIIFModel.CustomerName,
                                DueDate = objQBSalesInvoiceExportIIFModel.DueDate,
                                EstimatedTax = 0,
                                InvoiceDate = objQBSalesInvoiceExportIIFModel.InvoiceDate,
                                ItemName = APIResultsofTenant.Data.TaxReferenceNo,
                                OrderNumber = objQBSalesInvoiceExportIIFModel.OrderNumber,
                                OrderStatus = objQBSalesInvoiceExportIIFModel.OrderStatus,
                                Quantity = 0,
                                Total = objQBSalesInvoiceExportIIFModel.EstimatedTax,
                                TRNTotal = 0
                            });
                            lstQBInvoiceDetailModel.Add(new QBSalesInvoiceExportIIFModel
                            {
                                OrderID = objQBSalesInvoiceExportIIFModel.OrderID,
                                UnitPrice = 0,
                                DiscountAmount = 0,
                                OtherAmount = 0,
                                ShippingAmount = 0,
                                AccountingOrderID = objQBSalesInvoiceExportIIFModel.AccountingOrderID,
                                CustomerName = objQBSalesInvoiceExportIIFModel.CustomerName,
                                DueDate = objQBSalesInvoiceExportIIFModel.DueDate,
                                EstimatedTax = 0,
                                InvoiceDate = objQBSalesInvoiceExportIIFModel.InvoiceDate,
                                ItemName = APIResultsofTenant.Data.DiscountReferenceNo,
                                OrderNumber = objQBSalesInvoiceExportIIFModel.OrderNumber,
                                OrderStatus = objQBSalesInvoiceExportIIFModel.OrderStatus,
                                Quantity = 0,
                                Total = objQBSalesInvoiceExportIIFModel.DiscountAmount,
                                TRNTotal = 0
                            });
                            lstQBInvoiceDetailModel.Add(new QBSalesInvoiceExportIIFModel
                            {
                                OrderID = objQBSalesInvoiceExportIIFModel.OrderID,
                                UnitPrice = 0,
                                DiscountAmount = 0,
                                OtherAmount = 0,
                                ShippingAmount = 0,
                                AccountingOrderID = objQBSalesInvoiceExportIIFModel.AccountingOrderID,
                                CustomerName = objQBSalesInvoiceExportIIFModel.CustomerName,
                                DueDate = objQBSalesInvoiceExportIIFModel.DueDate,
                                EstimatedTax = 0,
                                InvoiceDate = objQBSalesInvoiceExportIIFModel.InvoiceDate,
                                ItemName = APIResultsofTenant.Data.ShippingReferenceNo,
                                OrderNumber = objQBSalesInvoiceExportIIFModel.OrderNumber,
                                OrderStatus = objQBSalesInvoiceExportIIFModel.OrderStatus,
                                Quantity = 0,
                                Total = objQBSalesInvoiceExportIIFModel.ShippingAmount,
                                TRNTotal = 0
                            });
                            lstQBInvoiceDetailModel.Add(new QBSalesInvoiceExportIIFModel
                            {
                                OrderID = objQBSalesInvoiceExportIIFModel.OrderID,
                                UnitPrice = 0,
                                DiscountAmount = 0,
                                OtherAmount = 0,
                                ShippingAmount = 0,
                                AccountingOrderID = objQBSalesInvoiceExportIIFModel.AccountingOrderID,
                                CustomerName = objQBSalesInvoiceExportIIFModel.CustomerName,
                                DueDate = objQBSalesInvoiceExportIIFModel.DueDate,
                                EstimatedTax = 0,
                                InvoiceDate = objQBSalesInvoiceExportIIFModel.InvoiceDate,
                                ItemName = APIResultsofTenant.Data.OtherReferenceNo,
                                OrderNumber = objQBSalesInvoiceExportIIFModel.OrderNumber,
                                OrderStatus = objQBSalesInvoiceExportIIFModel.OrderStatus,
                                Quantity = 0,
                                Total = objQBSalesInvoiceExportIIFModel.OtherAmount,
                                TRNTotal = 0
                            });
                            objQBSalesInvoiceExportIIFModel.TRNTotal = lstQBInvoiceDetailModel.Sum(x => x.Total);
                            body = body.Append("TRNS\t§TRNSID§\t§TRNSTYPE§\t§DATE§\t§ACCNT§\t§NAME§\t§CLASS§\t§AMOUNT§\t§DOCNUM§\t§MEMO§\t§CLEAR§\t§TOPRINT§\t§NAMEISTAXABLE§\t§ADDR1§\t§ADDR3§\t§TERMS§\t§SHIPVIA§\t§SHIPDATE§\t§DUEDATE§\r\n");
                            body = IIFBodyReplace(objQBSalesInvoiceExportIIFModel, body, FileType);
                            foreach (var subData in lstQBInvoiceDetailModel)
                            {
                                body = body.Append("SPL\t§SPLID§\t§TRNSTYPE§\t§DATE§\t§ACCNT§\t§NAME§\t§CLASS§\t§AMOUNT§\t§DOCNUM§\t§MEMO§\t§CLEAR§\t§QNTY§\t§PRICE§\t§INVITEM§\t§TAXABLE§\t§OTHER2§\t§YEARTODATE§\t§WAGEBASE§\t\r\n");
                                body = IIFBodyReplace(subData, body, FileType, true);
                            }
                            body = body.Append("ENDTRNS\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n");
                        }

                    }
                    break;
            }
            using (var sw = new StreamWriter(filename, true))
            {
                sw.Write(body);
                sw.Close();
            }
            strvalue = new string[] { strFileName, FolderName };
            return strvalue;
        }

        public StringBuilder IIFBodyReplace<T>(T data, StringBuilder body, string FileType, bool isSPL = false, string columnName = "")
        {
            switch (FileType)
            {
                case "ReceivePaymentFormat.iif":
                    #region Replace Parameters
                    QBPaymentDetailModel objQBPaymentDetailModel = (QBPaymentDetailModel)(object)data;
                    body = body.Replace("§TRNSID§", GetRandomNumber());
                    body = body.Replace("§TRNSTYPE§", "PAYMENT");
                    body = body.Replace("§DATE§", Convert.ToString(Convert.ToDateTime(objQBPaymentDetailModel.PaymentDate).ToString("MM/dd/yyyy")));
                    body = body.Replace("§ACCNT§", objQBPaymentDetailModel.AccountingAccountNo);
                    body = body.Replace("§NAME§", objQBPaymentDetailModel.CustomerRef);
                    body = body.Replace("§AMOUNT§", Convert.ToString(objQBPaymentDetailModel.PaymentAmount));
                    body = body.Replace("§DOCNUM§", Convert.ToString(objQBPaymentDetailModel.AccountingOrderID));
                    break;
                #endregion
                case "POVendorFormat.iif":
                    #region Replace Parameters
                    QuickBooksPurchaseOrderIIFVendorModel objQuickBooksPurchaseOrderIIFVendorModel = (QuickBooksPurchaseOrderIIFVendorModel)(object)data;
                    body = body.Replace("§NAME§", objQuickBooksPurchaseOrderIIFVendorModel.VendorName);
                    body = body.Replace("§REFNUM§", GetRandomNumber());
                    body = body.Replace("§TIMESTAMP§", Convert.ToString(Convert.ToDateTime(objQuickBooksPurchaseOrderIIFVendorModel.TimeStamp).ToString("yyyyMMddHHmmss")));
                    body = body.Replace("§PRINTAS§", objQuickBooksPurchaseOrderIIFVendorModel.Printas);
                    body = body.Replace("§ADDR1§", objQuickBooksPurchaseOrderIIFVendorModel.Address1);
                    body = body.Replace("§ADDR2§", objQuickBooksPurchaseOrderIIFVendorModel.Address2);
                    body = body.Replace("§ADDR3§", "");
                    body = body.Replace("§ADDR4§", "");
                    body = body.Replace("§ADDR5§", "");
                    body = body.Replace("§VTYPE§", "");
                    body = body.Replace("§CONT1§", objQuickBooksPurchaseOrderIIFVendorModel.Contact1);
                    body = body.Replace("§CONT2§", "");
                    body = body.Replace("§PHONE1§", objQuickBooksPurchaseOrderIIFVendorModel.Contact1);
                    body = body.Replace("§PHONE2§", "");
                    body = body.Replace("§FAXNUM§", "");
                    body = body.Replace("§EMAIL§", objQuickBooksPurchaseOrderIIFVendorModel.ContactEmail);
                    body = body.Replace("§NOTE§", "");
                    body = body.Replace("§TAXID§", "");
                    body = body.Replace("§LIMIT§", "");
                    body = body.Replace("§TERMS§", "");
                    body = body.Replace("§NOTEPAD§", "");
                    body = body.Replace("§SALUTATION§", "");
                    body = body.Replace("§COMPANYNAME§", "");
                    body = body.Replace("§FIRSTNAME§", "");
                    body = body.Replace("§MIDINIT§", "");
                    body = body.Replace("§LASTNAME§", "");
                    body = body.Replace("§CUSTFLD1§", "");
                    body = body.Replace("§CUSTFLD2§", "");
                    body = body.Replace("§CUSTFLD3§", "");
                    body = body.Replace("§CUSTFLD4§", "");
                    body = body.Replace("§CUSTFLD5§", "");
                    body = body.Replace("§CUSTFLD6§", "");
                    body = body.Replace("§CUSTFLD7§", "");
                    body = body.Replace("§CUSTFLD8§", "");
                    body = body.Replace("§CUSTFLD9§", "");
                    body = body.Replace("§CUSTFLD10§", "");
                    body = body.Replace("§CUSTFLD11§", "");
                    body = body.Replace("§CUSTFLD12§", "");
                    body = body.Replace("§CUSTFLD13§", "");
                    body = body.Replace("§CUSTFLD14§", "");
                    body = body.Replace("§CUSTFLD15§", "");
                    body = body.Replace("§1099§", "");
                    body = body.Replace("§HIDDEN§", "");
                    body = body.Replace("§DELCOUNT§", "");
                    break;
                #endregion
                case "PurchaseOrderFormat.iif":
                    #region Replace Parameter
                    QuickBooksPurchaseOrderListIIFModel objQuickBooksPurchaseOrderListIIFModel = (QuickBooksPurchaseOrderListIIFModel)(object)data;
                    if (!isSPL)
                    {
                        #region TRN Parameter
                        body = body.Replace("§TRNSTYPE§", "PURCHORD");
                        body = body.Replace("§DATE§", Convert.ToString(Convert.ToDateTime(objQuickBooksPurchaseOrderListIIFModel.OrderDate).ToString("MM/dd/yyyy")));// Convert.ToString(Convert.ToDateTime(objQuickBooksPurchaseOrderListIIFModel.OrderDate).ToString("MM/dd/yyyy")));
                        body = body.Replace("§CLASS§", "");
                        body = body.Replace("§AMOUNT§", Convert.ToString(objQuickBooksPurchaseOrderListIIFModel.TRNTotal * (-1)));
                        body = body.Replace("§DOCNUM§", GetRandomNumber());
                        body = body.Replace("§MEMO§", "");
                        body = body.Replace("§CLEAR§", "");
                        body = body.Replace("§PAYMETH§", "");
                        body = body.Replace("§ACCNT§", "Purchase Orders");
                        body = body.Replace("§NAME§", objQuickBooksPurchaseOrderListIIFModel.VendorName);
                        body = body.Replace("§TRNSID§", GetRandomNumber());
                        body = body.Replace("§TOPRINT§", "");
                        body = body.Replace("§NAMEISTAXABLE§", "N");
                        body = body.Replace("§ADDR1§", "");
                        body = body.Replace("§ADDR2§", "");
                        body = body.Replace("§ADDR3§", "");
                        body = body.Replace("§ADDR4§", "");
                        body = body.Replace("§ADDR5§", "");
                        body = body.Replace("§DUEDATE§", "");
                        body = body.Replace("§TERMS§", "");
                        body = body.Replace("§PAID§", "");
                        body = body.Replace("§SHIPVIA§", "");
                        body = body.Replace("§SHIPDATE§", "");
                        body = body.Replace("§OTHER1§", "");
                        body = body.Replace("§REP§", "");
                        body = body.Replace("§FOB§", "");
                        body = body.Replace("§PONUM§", "");
                        body = body.Replace("§INVTITLE§", "");
                        body = body.Replace("§INVMEMO§", "");
                        body = body.Replace("§SADDR1§", "");
                        body = body.Replace("§SADDR2§", "");
                        body = body.Replace("§SADDR3§", "");
                        body = body.Replace("§SADDR4§", "");
                        body = body.Replace("§SADDR5§", "");
                        #endregion
                    }
                    else
                    {
                        #region SPL Parameters
                        body = body.Replace("§TRNSTYPE§", "PURCHORD");
                        body = body.Replace("§DATE§", Convert.ToString(Convert.ToDateTime(objQuickBooksPurchaseOrderListIIFModel.OrderDate).ToString("MM/dd/yyyy")));//Convert.ToString(Convert.ToDateTime(objQuickBooksPurchaseOrderListIIFModel.OrderDate).ToString("MM/dd/yyyy"))
                        body = body.Replace("§CLASS§", "");
                        body = body.Replace("§AMOUNT§", Convert.ToString(objQuickBooksPurchaseOrderListIIFModel.Total));
                        body = body.Replace("§DOCNUM§", GetRandomNumber());
                        body = body.Replace("§MEMO§", "");
                        body = body.Replace("§CLEAR§", "");
                        body = body.Replace("§PAYMETH§", "");
                        body = body.Replace("§ACCNT§", "Inventory Asset");
                        body = body.Replace("§NAME§", "");
                        body = body.Replace("§SPLID§", Convert.ToString(objQuickBooksPurchaseOrderListIIFModel.OrderDetailID));
                        body = body.Replace("§QNTY§", Convert.ToString(objQuickBooksPurchaseOrderListIIFModel.Quantity));
                        body = body.Replace("§PRICE§", Convert.ToString(objQuickBooksPurchaseOrderListIIFModel.UnitPrice));
                        body = body.Replace("§INVITEM§", objQuickBooksPurchaseOrderListIIFModel.ItemName);
                        body = body.Replace("§TAXABLE§", "N");
                        body = body.Replace("§VALADJ§", "");
                        body = body.Replace("§REIMBEXP§", "");
                        body = body.Replace("§SERVICEDATE§", "");
                        body = body.Replace("§OTHER2§", "");
                        body = body.Replace("§OTHER3§", "");
                        body = body.Replace("§PAYITEM§", "");
                        body = body.Replace("§YEARTODATE§", "");
                        body = body.Replace("§WAGEBASE§", "");
                        body = body.Replace("§EXTRA§", "");
                        #endregion
                    }
                    break;
                #endregion
                case "SalesInvoiceFormat.iif":
                    #region Replace Parameter
                    QBSalesInvoiceExportIIFModel objQBSalesInvoiceExportIIFModel = (QBSalesInvoiceExportIIFModel)(object)data;
                    if (!isSPL)
                    {
                        body = body.Replace("§TRNSID§", GetRandomNumber());
                        body = body.Replace("§TRNSTYPE§", "INVOICE");
                        body = body.Replace("§DATE§", Convert.ToDateTime(objQBSalesInvoiceExportIIFModel.InvoiceDate).ToString("MM/dd/yyyy"));//Convert.ToDateTime(objQBSalesInvoiceExportIIFModel.InvoiceDate).ToString("MM/dd/yyyy")
                        body = body.Replace("§ACCNT§", "Accounts Receivable");
                        body = body.Replace("§NAME§", objQBSalesInvoiceExportIIFModel.CustomerName);
                        body = body.Replace("§CLASS§", "");
                        body = body.Replace("§AMOUNT§", Convert.ToString(objQBSalesInvoiceExportIIFModel.TRNTotal));
                        body = body.Replace("§DOCNUM§", GetRandomNumber());
                        body = body.Replace("§MEMO§", "");
                        body = body.Replace("§CLEAR§", "");
                        body = body.Replace("§TOPRINT§", "");
                        body = body.Replace("§NAMEISTAXABLE§", "");
                        body = body.Replace("§ADDR1§", "");
                        body = body.Replace("§ADDR3§", "");
                        body = body.Replace("§TERMS§", "");
                        body = body.Replace("§SHIPVIA§", "");
                        body = body.Replace("§SHIPDATE§", "");
                        body = body.Replace("§DUEDATE§", "12/25/2022");
                    }
                    else
                    {
                        body = body.Replace("§SPLID§", GetRandomNumber());
                        body = body.Replace("§TRNSTYPE§", "INVOICE");
                        body = body.Replace("§DATE§", Convert.ToDateTime(objQBSalesInvoiceExportIIFModel.InvoiceDate).ToString("MM/dd/yyyy"));// Convert.ToDateTime(objQBSalesInvoiceExportIIFModel.InvoiceDate).ToString("MM/dd/yyyy")
                        body = body.Replace("§ACCNT§", "Income Account");
                        body = body.Replace("§NAME§", "");
                        body = body.Replace("§CLASS§", "");
                        body = body.Replace("§AMOUNT§", Convert.ToString(objQBSalesInvoiceExportIIFModel.Total * (-1)));
                        body = body.Replace("§DOCNUM§", GetRandomNumber());
                        body = body.Replace("§MEMO§", "");
                        body = body.Replace("§CLEAR§", "");
                        body = body.Replace("§QNTY§", objQBSalesInvoiceExportIIFModel.Quantity > 0 ? Convert.ToString(objQBSalesInvoiceExportIIFModel.Quantity * (-1)) : "");
                        body = body.Replace("§PRICE§", Convert.ToString(objQBSalesInvoiceExportIIFModel.UnitPrice));
                        body = body.Replace("§INVITEM§", objQBSalesInvoiceExportIIFModel.ItemName);
                        body = body.Replace("§TAXABLE§", "N");
                        body = body.Replace("§OTHER2§", "");
                        body = body.Replace("§YEARTODATE§", "");
                        body = body.Replace("§WAGEBASE§", "");
                    }
                    #endregion
                    break;
            }
            return body;
        }

        public static string GetRandomNumber()
        {
            var bytes = new byte[4];
            var rng = RandomNumberGenerator.Create();
            rng.GetBytes(bytes);
            uint random = BitConverter.ToUInt32(bytes, 0) % 100000000;
            return String.Format("{0:D8}", random);
        }

    }

    public class CommonBarcodeMethod
    {
        public byte[] CommonBarcodeMethodLabelPrintDownload(DataTable dt,List<CommonQRCodeDataModel> CommonBarcodeLabelPrintList, int? LabelSizeId, int? LabelDesignId, int? LabelPageId, int? LabelQuantity, bool IsKitPick = false, bool IsFulfillSales = false,int FromWhichModule=1,bool IsPlantBarCode=false)
        {
            using (MemoryStream ms = new MemoryStream())
            {
                // Creae the document object, assigning the page margins
                Rectangle rec = null;
                int FontSize = 0;
                if (LabelSizeId == 1)
                {
                    rec = new Rectangle(283.68f, 153.36f);
                    FontSize = 10;
                }
                else if (LabelSizeId == 3)
                {
                    rec = new Rectangle(141.84f, 70.92f);
                    FontSize = 6;
                }
                else if (LabelSizeId == 4)
                {
                    rec = new Rectangle(70.92f, 70.92f);
                    FontSize = 4;
                }
                else
                {
                    rec = new Rectangle(252.31648f, 79.38046f);
                    FontSize = 8;
                }
                Document document = new Document(rec, 0, 0, 0, 0);
                PdfWriter writer = PdfWriter.GetInstance(document, ms);
                // Open the document, enabeling writing to the document
                //iTextSharp.text.Font font = new iTextSharp.text.Font(null, 10, iTextSharp.text.Font.NORMAL, BaseColor.BLACK);
                var font = FontFactory.GetFont("Segoe UI", 10, BaseColor.BLACK);
                document.Open();
                string ItemNumber = string.Empty;
                string LotNumber = string.Empty;
                string Package = string.Empty;
                string BatchNumber = string.Empty;
                if (LabelDesignId != null)
                {
                    string APIURL = "Admin/getLabelDesignItemByPageId?LabelPageId=" + LabelPageId;
                    var APIResult = CommonAPI.GetSync(APIURL).GetListSync<PageDesignItemModelDetails>();
                    List<PageDesignItemModelDetails> lstPageDesignItem = new List<PageDesignItemModelDetails>();
                    lstPageDesignItem = APIResult.Data;
                    
                    for (int i = 0; i < CommonBarcodeLabelPrintList.Count; i++)
                    {
                        string qrData = string.Empty;
                        
                        qrData = dt.Rows[i][0].ToString();
                        iTextSharp.text.pdf.BarcodeQRCode qrcode = new BarcodeQRCode(qrData, null); //it will generate needful width x height then scale it using ScaleAbsolute
                        iTextSharp.text.Image img1 = qrcode.GetImage();
                        img1.IndentationLeft = 0;
                        img1.IndentationRight = 0;
                        img1.ScaleAbsolute(104f, 104f);

                        PdfPTable table = new PdfPTable(2);
                        //table.TotalWidth
                        table.TotalWidth = LabelSizeId == 1 ? 282f : LabelSizeId == 3 ? 141f : LabelSizeId == 4 ? 70.5f : 251f;
                        table.LockedWidth = true;
                        table.DefaultCell.Border = 0;
                        //Set Column width
                        float[] widths = null;
                        if (LabelSizeId == 1)
                        {
                            widths = new float[] { 105f, 180f };
                        }
                        else if (LabelSizeId == 3)
                        {
                            widths = new float[] { 90f, 45f };
                        }
                        else if (LabelSizeId == 4)
                        {
                            widths = new float[] { 45f, 45f };
                        }
                        else
                        {
                            widths = new float[] { 77f, 174f };
                        }
                        table.SetWidths(widths);

                        int k = 0;
                        PdfPCell cell = new PdfPCell();
                        cell.Colspan = 2;
                        cell.Border = 0;
                        cell.NoWrap = false;
                        PdfPCell cell1 = new PdfPCell();
                        cell1.Border = 0;
                        if (IsFulfillSales)
                        {
                            var qtycol = CommonBarcodeLabelPrintList[i].IsReceivedItem.Split(ConnectionDB.SpecialCharacter);
                            LabelQuantity = LabelQuantity == 0 ? (qtycol[2].ToString().Trim() == "ea" ? (int)Math.Ceiling(Convert.ToDecimal(qtycol[1]) * Convert.ToDecimal(qtycol[3]) + Convert.ToDecimal(qtycol[3]) + 1) : (int)Math.Ceiling(Convert.ToDecimal(qtycol[3]) + 1)) : LabelQuantity;
                        }
                        foreach (var LableGroupItem in lstPageDesignItem)
                        {
                            string str = string.Empty;                            
                            switch (LableGroupItem.DataModelProperty)
                            {
                                case "PackageTag":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].PackageTag == "null" ? "" : CommonBarcodeLabelPrintList[i].PackageTag);
                                    break;
                                case "ProductDescription":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].ProductDescription == "null" ? "" : CommonBarcodeLabelPrintList[i].ProductDescription);
                                    break;
                                case "Category":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].Category == "null" ? "" : CommonBarcodeLabelPrintList[i].Category);
                                    break;
                                case "ItemNumber":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].ItemNumber == "null" ? "" : CommonBarcodeLabelPrintList[i].ItemNumber);
                                    break;
                                case "LotNumber":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].LotNumber == "null" ? "" : CommonBarcodeLabelPrintList[i].LotNumber);
                                    break;
                                case "CreatedDate":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].DateRecieved == "null" ? "" : CommonBarcodeLabelPrintList[i].DateRecieved);
                                    break;
                                case "VendorName":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].CompanyName == "null" || string.IsNullOrEmpty(CommonBarcodeLabelPrintList[i].CompanyName) ? "" : (CommonBarcodeLabelPrintList[i].CompanyName.Length > 26 ? CommonBarcodeLabelPrintList[i].CompanyName.Substring(0, 26) + ".." : CommonBarcodeLabelPrintList[i].CompanyName));
                                    break;
                                case "License":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].MED_Gov_LicenseNumber == "null" ? "" : CommonBarcodeLabelPrintList[i].MED_Gov_LicenseNumber);
                                    break;
                                case "THC":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].Potency == "null" ? "" : CommonBarcodeLabelPrintList[i].Potency);
                                    break;
                                case "CBD":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].PotencyCBD == "null" ? "" : CommonBarcodeLabelPrintList[i].PotencyCBD);
                                    break;
                                case "HarvestedDate":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].HarvestDate == "null" ? "" : CommonBarcodeLabelPrintList[i].HarvestDate);
                                    break;
                                case "TestedByLab":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].TestingLab == "null" ? "" : CommonBarcodeLabelPrintList[i].TestingLab);
                                    break;
                                case "StrainName":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].StrainName == "null" ? "" : CommonBarcodeLabelPrintList[i].StrainName);
                                    break;
                                case "CompanyName":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].LabelTennantName == "null" ? "" : CommonBarcodeLabelPrintList[i].LabelTennantName);
                                    break;
                                case "BatchNumber":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].BatchNumber == "null" ? "" : CommonBarcodeLabelPrintList[i].BatchNumber);
                                    break;
                                case "MetrcPackage":
                                    str = LableGroupItem.DataSuffix + (CommonBarcodeLabelPrintList[i].PackageTag == "null" ? "" : CommonBarcodeLabelPrintList[i].PackageTag);
                                    break;
                                case "PlantBatch":
                                    str = LableGroupItem.DataSuffix + " " + (!string.IsNullOrEmpty(CommonBarcodeLabelPrintList[i].Name) ? CommonBarcodeLabelPrintList[i].Name.ToString() : "");
                                    break;
                                case "SeedOrClone":
                                    str = CommonBarcodeLabelPrintList[i].PlantCount.ToString() + " " + CommonBarcodeLabelPrintList[i].Type;
                                    break;
                                case "PlantsCount":
                                    str = LableGroupItem.DataSuffix + " " + CommonBarcodeLabelPrintList[i].PlantCount;
                                    break;
                                case "PlantingDate":
                                    str = LableGroupItem.DataSuffix + " " + (CommonBarcodeLabelPrintList[i].PlantingDate == "null" ? "" : CommonBarcodeLabelPrintList[i].PlantingDate);
                                    break;
                                case "PlantTag":
                                    str = LableGroupItem.DataSuffix + " " + (!string.IsNullOrEmpty(CommonBarcodeLabelPrintList[i].PlantTag) ? CommonBarcodeLabelPrintList[i].PlantTag.ToString() : "");
                                    break;
                                case "VegetativeDate":
                                    str = LableGroupItem.DataSuffix + " " + (!string.IsNullOrEmpty(CommonBarcodeLabelPrintList[i].VegFlowDate) ? CommonBarcodeLabelPrintList[i].VegFlowDate.ToString() : "");
                                    break;
                                case "WetWeight":
                                    str = LableGroupItem.DataSuffix + " " + (!string.IsNullOrEmpty(CommonBarcodeLabelPrintList[i].Weight) ? CommonBarcodeLabelPrintList[i].Weight.ToString() : "");
                                    break;
                                case "HarvestName":
                                    str = LableGroupItem.DataSuffix + " " + (!string.IsNullOrEmpty(CommonBarcodeLabelPrintList[i].Name) ? CommonBarcodeLabelPrintList[i].Name.ToString() : "");
                                    break;
                                case "HarvestDate":
                                    str = LableGroupItem.DataSuffix + " " + (!string.IsNullOrEmpty(CommonBarcodeLabelPrintList[i].PlantingDate) ? CommonBarcodeLabelPrintList[i].PlantingDate.ToString() : "");
                                    break;
                                case "KitCommonID":
                                    str = LableGroupItem.DataSuffix + " " + (!string.IsNullOrEmpty(CommonBarcodeLabelPrintList[i].KitCommonID) ? CommonBarcodeLabelPrintList[i].KitCommonID.ToString() : "");
                                    break;
                                case "KitNumber":
                                    str = LableGroupItem.DataSuffix + " " + (!string.IsNullOrEmpty(CommonBarcodeLabelPrintList[i].KitNumber) ? CommonBarcodeLabelPrintList[i].KitNumber.ToString() : "");
                                    break;
                                case "RunSize":
                                    str = LableGroupItem.DataSuffix + " " + (!string.IsNullOrEmpty(CommonBarcodeLabelPrintList[i].RunSize) ? CommonBarcodeLabelPrintList[i].RunSize.ToString() : "");
                                    break;
                                case "Quantity":                                    
                                    if (IsFulfillSales)
                                    {
                                        var qtycol = CommonBarcodeLabelPrintList[i].IsReceivedItem.Split(ConnectionDB.SpecialCharacter);
                                        str = LableGroupItem.DataSuffix + " " + Convert.ToDecimal(qtycol[0]).ToString("0.######") + " unit (" + Convert.ToDecimal(qtycol[1]).ToString("0.######") + " " + qtycol[2].ToString().Trim() + ")";
                                    }
                                    break;
                                case "SKU":
                                    str = LableGroupItem.DataSuffix + " " + (!string.IsNullOrEmpty(CommonBarcodeLabelPrintList[i].SKU) ? CommonBarcodeLabelPrintList[i].SKU : "");
                                    break;
                                default: break;
                            }

                            //if (!IsPlantBarCode)
                            //{
                            if (LabelSizeId == 1)
                                {
                                    var packageTag = dt.Rows[i][0].ToString();
                                    cell = new PdfPCell();
                                    cell.Colspan = 2;
                                    cell.Border = 0;
                                    cell.NoWrap = false;
                                    cell.AddElement(new Phrase(str, FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (k < 2)
                                    {
                                        cell.HorizontalAlignment = 0; //0=Left, 1=Centre, 2=Right
                                        table.AddCell(cell);
                                    }
                                    else
                                    {
                                        //cell1 = new PdfPCell();
                                        //cell1.Border = 0;
                                        if (k == 3)
                                        {
                                            table.AddCell(img1);
                                        }
                                            cell1.AddElement(new Phrase(str, FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    }

                                }
                                else if (LabelSizeId == 3)
                                {
                                    
                                    cell.AddElement(new Phrase(str, FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    //table.AddCell(cell);
                                }
                                else if (LabelSizeId == 4)
                                {
                                    cell.AddElement(new Phrase(str, FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    //table.AddCell(cell);
                                }
                                else
                                {
                                    //First Column
                                    if(k==0)
                                    { 
                                        PdfPCell QRCell = new PdfPCell(img1);
                                        QRCell.Border = 0;
                                        QRCell.Rowspan = 1;
                                        QRCell.FixedHeight = 79.38046f;//LabelSizeId == 1 ? 153.36f : 79.38046f;
                                        QRCell.PaddingTop = 0f;
                                        QRCell.Padding = 0f;

                                        table.AddCell(QRCell);
                                    }
                                    cell1.AddElement(new Phrase(str, FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                }
                            //}
                            k++;
                        }
                        if(LabelSizeId==1 || LabelSizeId==2)
                        {
                            table.AddCell(cell1);
                        }
                        else
                        {
                            table.AddCell(cell);
                        }
                        for (int j = 0; j < LabelQuantity; j++)
                        {
                            document.Add(table);
                            document.NewPage();
                        }
                        
                    }
                    
                }

                else
                {
                    if (!IsPlantBarCode)
                    {
                        if (IsKitPick)
                        {
                            Package = "KIT:";
                            ItemNumber = "KT#:";
                            LotNumber = "RSZ:";
                        }
                        else
                        {
                            Package = "PKG:";
                            ItemNumber = "ITN:";
                            LotNumber = "LOT:";
                            BatchNumber = "BT#:";
                        }
                    }
                    var LabelQtyForSales = LabelQuantity;
                    for (int i = 0; i < dt.Rows.Count; i++)
                    {
                        LabelQuantity = LabelQtyForSales;
                        string qrData = string.Empty;

                        if (!IsPlantBarCode)
                        {
                            //if (dt.Rows[i][7].ToString() == "False")
                            if (IsKitPick)
                            {
                                Package = "KIT:";
                                ItemNumber = "KT#:";
                                LotNumber = "RSZ:";
                            }
                            else
                            {
                                Package = "PKG:";
                                ItemNumber = "ITN:";
                                LotNumber = "LOT:";
                                BatchNumber = "BT#:";
                            }

                            if (LabelSizeId == 1)
                            {
                                //qrData = Package + dt.Rows[i][0] + Environment.NewLine +
                                //    "CAT:" + (dt.Rows[i][2].ToString() != "null" ? dt.Rows[i][2] : "") + Environment.NewLine +
                                //    ItemNumber + (dt.Rows[i][3].ToString() != "null" ? dt.Rows[i][3] : "") + Environment.NewLine +
                                //    LotNumber + (dt.Rows[i][4].ToString() != "null" ? dt.Rows[i][4] : "") + Environment.NewLine +
                                //    "DAT:" + (dt.Rows[i][5].ToString() != "null" ? dt.Rows[i][5] : "") + Environment.NewLine +
                                //    "DES:" + (dt.Rows[i][1].ToString().Length > 50 ? dt.Rows[i][1].ToString().Substring(0, 50) + "..." : dt.Rows[i][1].ToString() != "null" ? dt.Rows[i][1] : "");
                                if (IsKitPick)
                                    qrData = dt.Rows[i][1].ToString() + "(" + dt.Rows[i][0] + ") Run Size(" + dt.Rows[i][4] + ")";
                                else
                                    qrData = dt.Rows[i][0].ToString();
                            }
                            else
                            {
                                //qrData = Package + dt.Rows[i][0] + Environment.NewLine +
                                //                                                 "DES:" + (dt.Rows[i][1].ToString().Length > 50 ? dt.Rows[i][1].ToString().Substring(0, 50) + "..." : dt.Rows[i][1].ToString() != "null" ? dt.Rows[i][1] : "");
                                if (IsKitPick)
                                    qrData = dt.Rows[i][1].ToString() + "(" + dt.Rows[i][0] + ") Run Size(" + dt.Rows[i][4] + ")";
                                else
                                    qrData = dt.Rows[i][0].ToString();
                            }
                        }
                        else
                        {
                            if (FromWhichModule == 1)//Immature
                            {
                                qrData = dt.Rows[i][0].ToString();
                            }
                            else if (FromWhichModule == 2)//Veg/Flo
                            {
                                qrData = dt.Rows[i][6].ToString();
                            }
                            else if (FromWhichModule == 3)//Harvest
                            {
                                qrData = dt.Rows[i][0].ToString();
                            }
                        }
                        iTextSharp.text.pdf.BarcodeQRCode qrcode = new BarcodeQRCode(qrData, null); //it will generate needful width x height then scale it using ScaleAbsolute
                        iTextSharp.text.Image img1 = qrcode.GetImage();
                        img1.IndentationLeft = 0;
                        img1.IndentationRight = 0;
                        img1.ScaleAbsolute(104f, 104f);

                        PdfPTable table = new PdfPTable(2);
                        //table.TotalWidth
                        table.TotalWidth = LabelSizeId == 1 ? 282f : LabelSizeId == 3 ? 141f : LabelSizeId == 4 ? 70.5f : 251f;
                        table.LockedWidth = true;
                        table.DefaultCell.Border = 0;
                        //Set Column width
                        float[] widths = null;
                        if (LabelSizeId == 1)
                        {
                            widths = new float[] { 105f, 180f };
                        }
                        else if (LabelSizeId == 3)
                        {
                            widths = new float[] { 90f, 45f };
                        }
                        else if (LabelSizeId == 4)
                        {
                            widths = new float[] { 45f, 45f };
                        }
                        else
                        {
                            widths = new float[] { 77f, 174f };
                        }
                        table.SetWidths(widths);

                        if (!IsPlantBarCode)
                        {
                            if (LabelSizeId == 1)
                            {
                                PdfPCell cell = new PdfPCell();
                                cell.Colspan = 2;
                                cell.Border = 0;
                                cell.NoWrap = false;
                                cell.HorizontalAlignment = 0; //0=Left, 1=Centre, 2=Right
                                var packageTag = dt.Rows[i][0].ToString();
                                cell.AddElement(new Phrase("  " + Package + " " + (packageTag.Length > 24 ? packageTag.Substring(0, 24) : packageTag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                if (packageTag.Length > 24)
                                {
                                    cell.AddElement(new Phrase((packageTag.Length > 24 ? packageTag.Substring(24, packageTag.Length - 24) : packageTag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                }
                                cell.AddElement(new Phrase("  CAT: " + (dt.Rows[i][2].ToString() != "null" ? dt.Rows[i][2] : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                table.AddCell(cell);
                                cell = new PdfPCell();
                                cell.Border = 0;
                                table.AddCell(img1);
                                cell.AddElement(new Phrase(ItemNumber + " " + (dt.Rows[i][3].ToString() != "null" ? dt.Rows[i][3] : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                /*cell.AddElement(new Phrase(LotNumber + " " + (dt.Rows[i][4].ToString() != "null" ? (dt.Rows[i][4].ToString().Split(ConnectionDB.SpecialCharacter)[4].Length > 24 ? dt.Rows[i][4].ToString().Split(ConnectionDB.SpecialCharacter)[4].Substring(0, 24) + ".." : dt.Rows[i][4].ToString().Split(ConnectionDB.SpecialCharacter)[4]) : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                if (!IsKitPick)
                                {
                                    cell.AddElement(new Phrase(BatchNumber + " " + (dt.Rows[i][16].ToString() != "null" ? (dt.Rows[i][16].ToString().Length > 24 ? dt.Rows[i][16].ToString().Substring(0, 24) + ".." : dt.Rows[i][16]) : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                }*/
                                cell.AddElement(new Phrase(LotNumber + " " + (dt.Rows[i][4].ToString() != "null" ? (dt.Rows[i][4].ToString().Length > 24 ? dt.Rows[i][4].ToString().Substring(0, 24) + ".." : dt.Rows[i][4]) : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                if (!IsKitPick)
                                {
                                    cell.AddElement(new Phrase(BatchNumber + " " + (dt.Rows[i][16].ToString() != "null" ? (dt.Rows[i][16].ToString().Length > 24 ? dt.Rows[i][16].ToString().Substring(0, 24) + ".." : dt.Rows[i][16]) : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                }
                                cell.AddElement(new Phrase("DAT: " + (dt.Rows[i][5].ToString() != "null" ? dt.Rows[i][5] : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                if (!IsKitPick)
                                {
                                    cell.AddElement(new Phrase("VEN: " + (dt.Rows[i][6].ToString() != "null" ? (dt.Rows[i][6].ToString().Length > 24 ? dt.Rows[i][6].ToString().Substring(0, 24) + ".." : dt.Rows[i][6]) : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (IsFulfillSales)
                                    {
                                        var qtycol = dt.Rows[i][7].ToString().Split(ConnectionDB.SpecialCharacter);
                                        cell.AddElement(new Phrase("QTY: " + Convert.ToDecimal(qtycol[0]).ToString("0.######") + " unit (" + Convert.ToDecimal(qtycol[1]).ToString("0.######") + " " + qtycol[2].ToString().Trim() + ")", FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        LabelQuantity = LabelQuantity == 0 ? (qtycol[2].ToString().Trim() == "ea" ? (int)Math.Ceiling(Convert.ToDecimal(qtycol[1]) * Convert.ToDecimal(qtycol[3]) + Convert.ToDecimal(qtycol[3]) + 1) : (int)Math.Ceiling(Convert.ToDecimal(qtycol[3]) + 1)) : LabelQuantity;
                                    }
                                }
                                cell.AddElement(new Phrase("DES: " + (dt.Rows[i][1].ToString() != "null" ? dt.Rows[i][1] : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                table.AddCell(cell);
                            }
                            else if (LabelSizeId == 3)
                            {
                                PdfPCell cell = new PdfPCell();
                                cell.Colspan = 2;
                                cell.Border = 0;
                                cell.HorizontalAlignment = 0; //0=Left, 1=Centre, 2=Right
                                var packageTag = dt.Rows[i][0].ToString();

                                if (IsKitPick) {
                                    cell.AddElement(new Phrase("  " + Package + " " + dt.Rows[i][0].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  CAT: " + (dt.Rows[i][2].ToString() != "null" ? dt.Rows[i][2] : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  DAT: " + (dt.Rows[i][5].ToString() != "null" ? dt.Rows[i][5] : "") + " | " + ItemNumber + " " + (dt.Rows[i][3].ToString() != "null" ? dt.Rows[i][3] : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  " + LotNumber + " " + (dt.Rows[i][4].ToString() != "null" ? (dt.Rows[i][4].ToString().Length > 24 ? dt.Rows[i][4].ToString().Substring(0, 24) + ".." : dt.Rows[i][4]) : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  DES: " + (dt.Rows[i][1].ToString() != "null" ? dt.Rows[i][1] : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                }
                                else
                                {
                                    cell.AddElement(new Phrase("  Company Name: " + dt.Rows[i][15], FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  License #: " + (dt.Rows[i][8].ToString() == "null" || dt.Rows[i][8].ToString() == "" ? "" : dt.Rows[i][8]), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  STR: " + (dt.Rows[i][14].ToString() == "null" || dt.Rows[i][14].ToString() == "" ? "" : dt.Rows[i][14]), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  Metrc #: " + (dt.Rows[i][0].ToString() == "null" || dt.Rows[i][0].ToString() == "" ? "" : (packageTag.Length > 24 ? packageTag.Substring(0, 24) : packageTag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (!(packageTag == "null" || packageTag == "") && packageTag.Length > 24)
                                    {
                                        cell.AddElement(new Phrase((packageTag.Length > 24 ? packageTag.Substring(24, packageTag.Length - 24) : packageTag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    }
                                    cell.AddElement(new Phrase("  THC: " + (dt.Rows[i][9].ToString() == "null" || dt.Rows[i][9].ToString() == "" ? "" : Convert.ToDecimal(dt.Rows[i][9]).ToString("0.##") + "%") + "  CBD: " + (dt.Rows[i][10].ToString() == "null" || dt.Rows[i][10].ToString() == "" ? "" : Convert.ToDecimal(dt.Rows[i][10]).ToString("0.##") + "%"), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  Harvest Date: " + (dt.Rows[i][11].ToString() == "null" || dt.Rows[i][11].ToString() == "" ? "" : dt.Rows[i][11]), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  Tested By Lab: " + (dt.Rows[i][13].ToString() == "null" || dt.Rows[i][13].ToString() == "" ? "" : dt.Rows[i][13]), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (IsFulfillSales)
                                    {
                                        var qtycol = dt.Rows[i][7].ToString().Split(ConnectionDB.SpecialCharacter);
                                        LabelQuantity = LabelQuantity == 0 ? (qtycol[2].ToString().Trim() == "ea" ? (int)Math.Ceiling(Convert.ToDecimal(qtycol[1]) * Convert.ToDecimal(qtycol[3]) + Convert.ToDecimal(qtycol[3]) + 1) : (int)Math.Ceiling(Convert.ToDecimal(qtycol[3]) + 1)) : LabelQuantity;
                                    }
                                }
                                table.AddCell(cell);
                            }
                            else if (LabelSizeId == 4)
                            {
                                PdfPCell cell = new PdfPCell();
                                cell.Colspan = 2;
                                cell.Border = 0;
                                cell.HorizontalAlignment = 0; //0=Left, 1=Centre, 2=Right
                                var packageTag = dt.Rows[i][0].ToString();
                                if (IsKitPick)
                                {
                                    cell.AddElement(new Phrase("  " + Package + " " + dt.Rows[i][0].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  CAT: " + (dt.Rows[i][2].ToString() != "null" ? dt.Rows[i][2] : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  DAT: " + (dt.Rows[i][5].ToString() != "null" ? dt.Rows[i][5] : "") + " | " + ItemNumber + " " + (dt.Rows[i][3].ToString() != "null" ? dt.Rows[i][3] : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  " + LotNumber + " " + (dt.Rows[i][4].ToString() != "null" ? (dt.Rows[i][4].ToString().Length > 24 ? dt.Rows[i][4].ToString().Substring(0, 24) + ".." : dt.Rows[i][4]) : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  DES: " + (dt.Rows[i][1].ToString() != "null" ? dt.Rows[i][1] : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                }
                                else
                                {
                                    cell.AddElement(new Phrase("  Item Name: " + dt.Rows[i][1], FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  Package Tag: " + (dt.Rows[i][0].ToString() == "null" || dt.Rows[i][0].ToString() == "" ? "" : (packageTag.Length > 12 ? packageTag.Substring(0, 12) : packageTag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (!(packageTag == "null" || packageTag == "") && packageTag.Length > 12)
                                    {
                                        cell.AddElement(new Phrase((packageTag.Length > 12 ? packageTag.Substring(12, packageTag.Length - 12) : packageTag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    }
                                    cell.AddElement(new Phrase("  THC: " + (dt.Rows[i][9].ToString() == "null" || dt.Rows[i][9].ToString() == "" ? "" : (Convert.ToDecimal(dt.Rows[i][9]).ToString("0.##")) + "%"), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  CBD: " + (dt.Rows[i][10].ToString() == "null" || dt.Rows[i][10].ToString() == "" ? "" : (Convert.ToDecimal(dt.Rows[i][10]).ToString("0.##")) + "%"), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  Harvest Date: " + (dt.Rows[i][11].ToString() == "null" || dt.Rows[i][11].ToString() == "" ? "" : dt.Rows[i][11]), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  Testing Lab: " + (dt.Rows[i][13].ToString() == "null" || dt.Rows[i][13].ToString() == "" ? "" : dt.Rows[i][13]), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  License #: " + (dt.Rows[i][8].ToString() == "null" || dt.Rows[i][8].ToString() == "" ? "" : dt.Rows[i][8]), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (IsFulfillSales)
                                    {
                                        var qtycol = dt.Rows[i][7].ToString().Split(ConnectionDB.SpecialCharacter);
                                        LabelQuantity = LabelQuantity == 0 ? (qtycol[2].ToString().Trim() == "ea" ? (int)Math.Ceiling(Convert.ToDecimal(qtycol[1]) * Convert.ToDecimal(qtycol[3]) + Convert.ToDecimal(qtycol[3]) + 1) : (int)Math.Ceiling(Convert.ToDecimal(qtycol[3]) + 1)) : LabelQuantity;
                                    }
                                }
                                table.AddCell(cell);
                            }
                            else
                            {
                                //First Column
                                PdfPCell QRCell = new PdfPCell(img1);
                                QRCell.Border = 0;
                                QRCell.Rowspan = 1;
                                QRCell.FixedHeight = 79.38046f;//LabelSizeId == 1 ? 153.36f : 79.38046f;
                                QRCell.PaddingTop = 0f;
                                QRCell.Padding = 0f;

                                table.AddCell(QRCell);
                                PdfPCell PackageDetail = new PdfPCell();
                                PackageDetail.Border = 0;
                                var packageTag = dt.Rows[i][0].ToString();
                                PackageDetail.AddElement(new Phrase(Package + " " + (packageTag == "null" || packageTag == "" ? "" : (packageTag.Length > 24 ? packageTag.Substring(0, 24) : packageTag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                if (!(packageTag == "null" || packageTag == "") && packageTag.Length > 24)
                                {
                                    PackageDetail.AddElement(new Phrase((packageTag.Length > 24 ? packageTag.Substring(24, packageTag.Length - 24) : packageTag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                }
                                PackageDetail.AddElement(new Phrase("CAT: " + (dt.Rows[i][2].ToString() != "null" ? dt.Rows[i][2] : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                PackageDetail.AddElement(new Phrase("DAT: " + (dt.Rows[i][5].ToString() != "null" ? dt.Rows[i][5] : "") + " | " + ItemNumber + " " + (dt.Rows[i][3].ToString() != "null" ? dt.Rows[i][3] : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                PackageDetail.AddElement(new Phrase(LotNumber + " " + (dt.Rows[i][4].ToString() != "null" ? (dt.Rows[i][4].ToString().Length > 24 ? dt.Rows[i][4].ToString().Substring(0, 24) + ".." : dt.Rows[i][4]) : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                if (!IsKitPick)
                                {
                                    PackageDetail.AddElement(new Phrase("VEN: " + (dt.Rows[i][6].ToString() != "null" ? (dt.Rows[i][6].ToString().Length > 28 ? dt.Rows[i][6].ToString().Substring(0, 28) + ".." : dt.Rows[i][6]) : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (IsFulfillSales)
                                    {
                                        var qtycol = dt.Rows[i][7].ToString().Split(ConnectionDB.SpecialCharacter);
                                        PackageDetail.AddElement(new Phrase("QTY: " + Convert.ToDecimal(qtycol[0]).ToString("0.######") + " unit (" + Convert.ToDecimal(qtycol[1]).ToString("0.######") + " " + qtycol[2].ToString().Trim() + ")", FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        LabelQuantity = LabelQuantity == 0 ? (qtycol[2].ToString().Trim() == "ea" ? (int)Math.Ceiling(Convert.ToDecimal(qtycol[1]) * Convert.ToDecimal(qtycol[3]) + Convert.ToDecimal(qtycol[3]) + 1) : (int)Math.Ceiling(Convert.ToDecimal(qtycol[3]) + 1)) : LabelQuantity;
                                    }
                                }
                                PackageDetail.AddElement(new Phrase("DES: " + (dt.Rows[i][1].ToString() != "null" ? dt.Rows[i][1] : ""), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                PackageDetail.FixedHeight = LabelSizeId == 1 ? 153.36f : 79.38046f;
                                table.AddCell(PackageDetail);
                            }
                        }
                        else
                        {
                            var strainname = dt.Rows[i][3].ToString();
                            var packagetag = dt.Rows[i][5].ToString();
                            var planttag = dt.Rows[i][6].ToString();
                            var isflowering = dt.Rows[i][9].ToString();
                            if (LabelSizeId == 1)
                            {
                                PdfPCell cell = new PdfPCell();
                                cell.Colspan = 2;
                                cell.Border = 0;
                                cell.NoWrap = false;
                                cell.HorizontalAlignment = 0; //0=Left, 1=Centre, 2=Right


                                if (FromWhichModule == 1)
                                {
                                    cell.AddElement(new Phrase("  PB: " + dt.Rows[i][0].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  " + dt.Rows[i][2].ToString() + " " + dt.Rows[i][1].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    table.AddCell(cell);
                                    cell = new PdfPCell();
                                    cell.Border = 0;
                                    table.AddCell(img1);
                                    cell.AddElement(new Phrase("  STR: " + strainname, FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  PLDT: " + dt.Rows[i][4].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (!string.IsNullOrEmpty(packagetag))
                                    {
                                        cell.AddElement(new Phrase("  PKG: " + (string.IsNullOrEmpty(packagetag) ? "" : (packagetag.Length > 24 ? packagetag.Substring(0, 24) : packagetag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        if (!string.IsNullOrEmpty(packagetag) && packagetag.Length > 24)
                                        {
                                            cell.AddElement(new Phrase((packagetag.Length > 24 ? packagetag.Substring(24, packagetag.Length - 24) : packagetag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        }
                                    }
                                    if (!string.IsNullOrEmpty(planttag))
                                    {
                                        cell.AddElement(new Phrase("  PLN: " + (string.IsNullOrEmpty(planttag) ? "" : (planttag.Length > 24 ? planttag.Substring(0, 24) : planttag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        if (!(string.IsNullOrEmpty(planttag)) && planttag.Length > 24)
                                        {
                                            cell.AddElement(new Phrase((planttag.Length > 24 ? planttag.Substring(24, planttag.Length - 24) : planttag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        }
                                    }
                                    table.AddCell(cell);
                                }
                                if (FromWhichModule == 2)
                                {
                                    cell.AddElement(new Phrase("  PLN: " + (string.IsNullOrEmpty(planttag) ? "" : (planttag.Length > 24 ? planttag.Substring(0, 24) : planttag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (!(string.IsNullOrEmpty(planttag)) && planttag.Length > 24)
                                    {
                                        cell.AddElement(new Phrase((planttag.Length > 24 ? planttag.Substring(24, planttag.Length - 24) : planttag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    }
                                    cell.AddElement(new Phrase("  PB: " + dt.Rows[i][0].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    table.AddCell(cell);
                                    cell = new PdfPCell();
                                    cell.Border = 0;
                                    table.AddCell(img1);
                                    cell.AddElement(new Phrase("  " + dt.Rows[i][2].ToString() + " " + dt.Rows[i][1].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  STR: " + strainname, FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  PLDT: " + dt.Rows[i][4].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));

                                    cell.AddElement(new Phrase((isflowering.ToLower() == "true" ? "  FWDT: " : "  VGDT: ") + dt.Rows[i][7].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));

                                    table.AddCell(cell);
                                }
                                if (FromWhichModule == 3)
                                {
                                    cell.AddElement(new Phrase("  HV Name: " + dt.Rows[i][0].ToString() + " - " + dt.Rows[i][1].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  STR: " + strainname.Substring(0, strainname.Length > 30 ? (strainname.Length - 30) : strainname.Length), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    table.AddCell(cell);
                                    cell = new PdfPCell();
                                    cell.Border = 0;
                                    table.AddCell(img1);
                                    cell.AddElement(new Phrase(" WETWT: " + dt.Rows[i][8].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  HVDT: " + dt.Rows[i][4].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  Plants: " + dt.Rows[i][2].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));

                                    table.AddCell(cell);
                                }

                            }
                            else if (LabelSizeId == 3)
                            {
                                PdfPCell cell = new PdfPCell();
                                cell.Colspan = 2;
                                cell.Border = 0;
                                cell.HorizontalAlignment = 0; //0=Left, 1=Centre, 2=Right

                                if (FromWhichModule == 1)
                                {
                                    cell.AddElement(new Phrase("  PB: " + dt.Rows[i][0].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  " + dt.Rows[i][2].ToString() + " " + dt.Rows[i][1].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  STR: " + strainname, FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  PLDT: " + dt.Rows[i][4].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (!string.IsNullOrEmpty(packagetag))
                                    {
                                        cell.AddElement(new Phrase("  PKG: " + (string.IsNullOrEmpty(packagetag) ? "" : (packagetag.Length > 24 ? packagetag.Substring(0, 24) : packagetag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        if (!string.IsNullOrEmpty(packagetag) && packagetag.Length > 24)
                                        {
                                            cell.AddElement(new Phrase((packagetag.Length > 24 ? packagetag.Substring(24, packagetag.Length - 24) : packagetag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        }
                                    }
                                    if (!string.IsNullOrEmpty(planttag))
                                    {
                                        cell.AddElement(new Phrase("  PLN: " + (string.IsNullOrEmpty(planttag) ? "" : (planttag.Length > 24 ? planttag.Substring(0, 24) : planttag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        if (!(string.IsNullOrEmpty(planttag)) && planttag.Length > 24)
                                        {
                                            cell.AddElement(new Phrase((planttag.Length > 24 ? planttag.Substring(24, planttag.Length - 24) : planttag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        }
                                    }
                                }
                                if (FromWhichModule == 2)
                                {
                                    cell.AddElement(new Phrase("  PLN: " + (string.IsNullOrEmpty(planttag) ? "" : (planttag.Length > 24 ? planttag.Substring(0, 24) : planttag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (!(string.IsNullOrEmpty(planttag)) && planttag.Length > 24)
                                    {
                                        cell.AddElement(new Phrase((planttag.Length > 24 ? planttag.Substring(24, planttag.Length - 24) : planttag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    }
                                    cell.AddElement(new Phrase("  PB: " + dt.Rows[i][0].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  " + dt.Rows[i][2].ToString() + " " + dt.Rows[i][1].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  STR: " + strainname, FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  PLDT: " + dt.Rows[i][4].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase((isflowering.ToLower() == "true" ? "  Flw. Date: " : "  Veg. Date: ") + dt.Rows[i][7].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                }
                                if (FromWhichModule == 3)
                                {
                                    cell.AddElement(new Phrase("  HV Name: " + dt.Rows[i][0].ToString() + " - " + dt.Rows[i][1].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  STR: " + strainname.Substring(0, strainname.Length > 30 ? (strainname.Length - 30) : strainname.Length), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  WETWT: " + dt.Rows[i][8].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  HVDT: " + dt.Rows[i][4].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  Plants: " + dt.Rows[i][2].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                }
                                table.AddCell(cell);
                            }
                            else if (LabelSizeId == 4)
                            {
                                PdfPCell cell = new PdfPCell();
                                cell.Colspan = 2;
                                cell.Border = 0;
                                cell.HorizontalAlignment = 0; //0=Left, 1=Centre, 2=Right

                                if (FromWhichModule == 1)
                                {
                                    cell.AddElement(new Phrase("  PB: " + dt.Rows[i][0].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  " + dt.Rows[i][2].ToString() + " " + dt.Rows[i][1].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  STR: " + strainname, FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  PLDT: " + dt.Rows[i][4].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (!string.IsNullOrEmpty(packagetag))
                                    {
                                        cell.AddElement(new Phrase("  PKG: " + (string.IsNullOrEmpty(packagetag) ? "" : (packagetag.Length > 24 ? packagetag.Substring(0, 24) : packagetag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        if (!string.IsNullOrEmpty(packagetag) && packagetag.Length > 24)
                                        {
                                            cell.AddElement(new Phrase((packagetag.Length > 24 ? packagetag.Substring(24, packagetag.Length - 24) : packagetag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        }
                                    }
                                    if (!string.IsNullOrEmpty(planttag))
                                    {
                                        cell.AddElement(new Phrase("  PLN: " + (string.IsNullOrEmpty(planttag) ? "" : (planttag.Length > 24 ? planttag.Substring(0, 24) : planttag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        if (!(string.IsNullOrEmpty(planttag)) && planttag.Length > 24)
                                        {
                                            cell.AddElement(new Phrase((planttag.Length > 24 ? planttag.Substring(24, planttag.Length - 24) : planttag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        }
                                    }
                                }
                                if (FromWhichModule == 2)
                                {
                                    cell.AddElement(new Phrase("  PLN: " + (string.IsNullOrEmpty(planttag) ? "" : (planttag.Length > 24 ? planttag.Substring(0, 24) : planttag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (!(string.IsNullOrEmpty(planttag)) && planttag.Length > 24)
                                    {
                                        cell.AddElement(new Phrase((planttag.Length > 24 ? planttag.Substring(24, planttag.Length - 24) : planttag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    }
                                    cell.AddElement(new Phrase("  PB: " + dt.Rows[i][0].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  " + dt.Rows[i][2].ToString() + " " + dt.Rows[i][1].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  STR: " + strainname, FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  PLDT: " + dt.Rows[i][4].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase((isflowering.ToLower() == "true" ? "  Flw. Date: " : "  Veg. Date: ") + dt.Rows[i][7].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                }
                                if (FromWhichModule == 3)
                                {
                                    cell.AddElement(new Phrase("  HV Name: " + dt.Rows[i][0].ToString() + " - " + dt.Rows[i][1].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  STR: " + strainname.Substring(0, strainname.Length > 30 ? (strainname.Length - 30) : strainname.Length), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  WETWT: " + dt.Rows[i][8].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  HVDT: " + dt.Rows[i][4].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  Plants: " + dt.Rows[i][2].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                }
                                table.AddCell(cell);
                            }
                            else
                            {
                                //First Column
                                PdfPCell cell = new PdfPCell(img1);
                                cell.Border = 0;
                                cell.Rowspan = 1;
                                cell.FixedHeight = 79.38046f;//LabelSizeId == 1 ? 153.36f : 79.38046f;
                                cell.PaddingTop = 0f;
                                cell.Padding = 0f;

                                table.AddCell(cell);
                                cell = new PdfPCell();
                                cell.Border = 0;
                                cell.FixedHeight = LabelSizeId == 1 ? 153.36f : 79.38046f;

                                if (FromWhichModule == 1)
                                {
                                    cell.AddElement(new Phrase("  PB: " + dt.Rows[i][0].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  " + dt.Rows[i][2].ToString() + " " + dt.Rows[i][1].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  STR: " + strainname, FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  PLDT: " + dt.Rows[i][4].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (!string.IsNullOrEmpty(packagetag))
                                    {
                                        cell.AddElement(new Phrase("  PKG: " + (string.IsNullOrEmpty(packagetag) ? "" : (packagetag.Length > 24 ? packagetag.Substring(0, 24) : packagetag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        if (!string.IsNullOrEmpty(packagetag) && packagetag.Length > 24)
                                        {
                                            cell.AddElement(new Phrase((packagetag.Length > 24 ? packagetag.Substring(24, packagetag.Length - 24) : packagetag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        }
                                    }
                                    if (!string.IsNullOrEmpty(planttag))
                                    {
                                        cell.AddElement(new Phrase("  PLN: " + (string.IsNullOrEmpty(planttag) ? "" : (planttag.Length > 24 ? planttag.Substring(0, 24) : planttag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        if (!(string.IsNullOrEmpty(planttag)) && planttag.Length > 24)
                                        {
                                            cell.AddElement(new Phrase((planttag.Length > 24 ? planttag.Substring(24, planttag.Length - 24) : planttag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                        }
                                    }
                                }
                                if (FromWhichModule == 2)
                                {
                                    cell.AddElement(new Phrase("  PLN: " + (string.IsNullOrEmpty(planttag) ? "" : (planttag.Length > 24 ? planttag.Substring(0, 24) : planttag)), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    if (!(string.IsNullOrEmpty(planttag)) && planttag.Length > 24)
                                    {
                                        cell.AddElement(new Phrase((planttag.Length > 24 ? planttag.Substring(24, planttag.Length - 24) : planttag), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    }
                                    cell.AddElement(new Phrase("  PB: " + dt.Rows[i][0].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  " + dt.Rows[i][2].ToString() + " " + dt.Rows[i][1].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  STR: " + strainname, FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  PLDT: " + dt.Rows[i][4].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase((isflowering.ToLower() == "true" ? "  Flw. Date: " : "  Veg. Date: ") + dt.Rows[i][7].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                }
                                if (FromWhichModule == 3)
                                {
                                    cell.AddElement(new Phrase("  HV Name: " + dt.Rows[i][0].ToString() + " - " + dt.Rows[i][1].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  STR: " + strainname.Substring(0, strainname.Length > 30 ? (strainname.Length - 30) : strainname.Length), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  WETWT: " + dt.Rows[i][8].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  HVDT: " + dt.Rows[i][4].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                    cell.AddElement(new Phrase("  Plants: " + dt.Rows[i][2].ToString(), FontFactory.GetFont(FontFactory.HELVETICA, FontSize)));
                                }

                                table.AddCell(cell);
                            }
                        }

                        for (int j = 0; j < LabelQuantity; j++)
                        {
                            document.Add(table);
                            document.NewPage();
                        }

                    }
                }

                document.Close();
                writer.Close();
                ms.Close();
                return ms.GetBuffer();
            }
        }
    }

    public static class CommonGrandTotalForSales
    {
        public static decimal GetTotalAmount(decimal? orderTotalBeforeTax, decimal? discount, bool discountType, decimal? regularTax, decimal? exciseTax, decimal? shippingAmount, decimal? otherAmount, bool IsSalesTaxBeforeDiscount = false, decimal bulkDiscount = 0)
        {
            decimal? result = 0;
            try
            {
                if (discountType)
                {
                    decimal? discountAmount = 0;
                    discountAmount = ((orderTotalBeforeTax * discount) / 100);
                    result = regularTax + exciseTax + shippingAmount + otherAmount + (orderTotalBeforeTax - discountAmount);
                }
                else
                {
                    result = regularTax + exciseTax + shippingAmount + otherAmount + (orderTotalBeforeTax - discount);
                }
                result = result - bulkDiscount;
            }
            catch (Exception)
            {
                throw;
            }
            return Convert.ToDecimal(result);
        }
    }
    public partial class Header : PdfPageEventHelper
    {
        #region Properties
        private string _Title;
        public string Title
        {
            get { return _Title; }
            set { _Title = value; }
        }

        #endregion
        public override void OnStartPage(PdfWriter writer, Document document)
        {
            Paragraph header = new Paragraph(Title, FontFactory.GetFont(FontFactory.TIMES, 14, iTextSharp.text.Font.BOLD));
            header.Alignment = Element.ALIGN_RIGHT;
            PdfPTable headerTbl = new PdfPTable(1);
            if (!string.IsNullOrWhiteSpace(Title) && Title.Contains("OMMA"))
            { headerTbl.TotalWidth = 500; }
            else
            { headerTbl.TotalWidth = 300; }

            headerTbl.HorizontalAlignment = Element.ALIGN_CENTER;
            PdfPCell cell = new PdfPCell(header);
            cell.Border = 0;
            headerTbl.AddCell(cell);
            Rectangle pageSize = document.PageSize;
            float headerTextWidth = cell.Width;

            headerTbl.WriteSelectedRows(0, -1, pageSize.GetLeft(pageSize.Width - (headerTbl.TotalWidth) / 2) / 2, pageSize.GetTop(10), writer.DirectContent);
        }
    }

    public static class CommonMetricErrorEmail
    {
        public static void SendMetricErrorEmail(int eventLogId)
        {
            try
            {
                var APIResult = CommonAPI.GetSync("Inventory/GetUserListForEmail").GetListSync<UserListForEmailModel>();
                if (APIResult != null && APIResult.Data != null)
                {
                    var APIResultOfT = CommonAPI.GetSync("Common/GetCompanyDetailOfTenantList").GetListSync<TenantDetailModel>();
                    List<TenantDetailModel> tenantDetailModelList = APIResultOfT.Data;

                    string MailBody = string.Empty;
                    string MailSubject = "Real-Time Metrc Error";

                    var response = CommonAPI.GetSyncWithoutAuth("Common/GetIntrinsicRunValueByTenant?InstrinsicKey=RealTimeMetricError").GetModelSync<IntrinsicValueModel>();
                    MailBody = response.Data.RunValue;
                    MailBody = MailBody.Replace("##EventLogID##", Convert.ToString(eventLogId));

                    foreach (var item in APIResult.Data)
                    {
                        if (!string.IsNullOrEmpty(item.Email))
                        {
                            string STenantId = item.TenantID.ToString().Encrypt();
                            TenantDetailModel tenantDetailModel = new TenantDetailModel();
                            tenantDetailModel = tenantDetailModelList.Where(x => x.TenantID == Convert.ToInt32(item.TenantID)).FirstOrDefault();

                            if (tenantDetailModel != null)
                            {
                                string CurrentTenantLogo = (string.IsNullOrEmpty(tenantDetailModel.PictureName)) ? "logo1.png" : (CommonStaticMethods.IsFileExist("~/Content/images/TenantLogo/logo" + STenantId + Path.GetExtension(tenantDetailModel.PictureName))) ? "TenantLogo/logo" + STenantId + Path.GetExtension(tenantDetailModel.PictureName) : "logo1.png";
                                MailBody = MailBody.Replace("##TENANTLOGO##", CurrentTenantLogo);

                                string TenantCompanyName = "";
                                if (!string.IsNullOrEmpty(tenantDetailModel.TenantDBAName))
                                    TenantCompanyName = tenantDetailModel.TenantDBAName;
                                else
                                    TenantCompanyName = tenantDetailModel.CompanyName;
                                MailBody = MailBody.Replace("##TENANTCOMPANYNAME##", TenantCompanyName);
                                MailBody = MailBody.Replace("##SITEURL##", ConnectionDB.BaseURL);

                                var EmailSettingModel = CommonAPI.GetSyncWithoutAuth("Common/GetEmailSettings", item.TenantID.ToString().Encrypt(), "0".Encrypt()).GetModelSync<EmailSettingModel>();

                                EmailTypeModel emailTypeModel = new EmailTypeModel();
                                emailTypeModel.TenantID = Convert.ToInt32(item.TenantID);
                                emailTypeModel.UserID = item.UserId;
                                emailTypeModel.EmailType = CommonEnum.EmailType.RealTimeMetrcSendError.ToInt();
                                string ToBccAddress = string.Empty;

                                var result = CommonStaticMethods.SendEmail(EmailSettingModel.Data, emailTypeModel, ToBccAddress, item.Email, MailBody, MailSubject);
                            }
                        }
                    }
                }
            }
            catch (Exception e)
            {
                throw;
            }
        }
    }

    public class CatalogUrlConstraint : IRouteConstraint
    {
        public bool Match(HttpContextBase httpContext, Route route, string parameterName, RouteValueDictionary values, RouteDirection routeDirection)
        {
            var TenantID = "0".Encrypt();
            var UserID = "0".Encrypt();
            var AccessID = "0|system".Encrypt();
            List<CatalogUrlModels> catalogUrlList = new List<CatalogUrlModels>();
            var APIResult = CommonAPI.GetSyncWithoutAuth("Common/GetCatalogUrlList", TenantID, UserID, AccessID).GetListSync<CatalogUrlModels>();
            if (APIResult.Data != null)
            {
                catalogUrlList = APIResult.Data;
            }
            var catalogurllink = values["catalogurllink"].ToString();
            if (catalogUrlList.Any(x => x.CatalogUrl == catalogurllink))
            {
                var tenantDetails = catalogUrlList.Where(x => x.CatalogUrl == catalogurllink).FirstOrDefault();

                //values.Add("TenantID", tenantDetails.TenantID.ToString().Encrypt());
                values.Add("TenantDetails", tenantDetails);
                return true;
            }
            return false;            
        }
    }


</pre>
                </div>
            </div>    
        </div>
    </div>
</body>
</html>
